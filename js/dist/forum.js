(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var e in n)t.o(n,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:n[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{common:()=>B,forum:()=>Zt});const n=flarum.core.compat["forum/app"];var e=t.n(n);const o=flarum.core.compat["common/extend"];function a(t,r){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},a(t,r)}function i(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,a(t,r)}const u=flarum.core.compat["common/Component"];var s=t.n(u);const c=flarum.core.compat["common/utils/classList"];var l=t.n(c),d=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).hasFocus=!1,r}i(r,t);var n=r.prototype;return n.decimals=function(){return this.attrs.decimals||0},n.min=function(){return this.attrs.min},n.max=function(){return this.attrs.max},n.step=function(){return this.attrs.step},n.disabled=function(){return!!this.attrs.disabled},n.readonly=function(){return!!this.attrs.readonly},n.className=function(){return[{focused:this.hasFocus},this.attrs.className]},n.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},n.toIntegerValue=function(t){return Math.round(t*Math.pow(10,this.decimals()))},n.inputAttrs=function(){var t=this,r={type:"number",value:this.fromIntegerValue(this.attrs.value)+"",onchange:function(r){var n=parseFloat(r.target.value);t.attrs.onchange(t.toIntegerValue(n))},onfocus:function(){t.hasFocus=!0},onblur:function(){t.hasFocus=!1},disabled:this.disabled(),readonly:this.readonly()},n=this.min();void 0!==n&&(r.min=this.fromIntegerValue(n));var e=this.max();void 0!==e&&(r.max=this.fromIntegerValue(e));var o=this.step();return void 0!==o?r.step=this.fromIntegerValue(o):this.decimals()>0&&(r.step=1/Math.pow(10,this.decimals())),r},n.unitLabel=function(){return""},n.view=function(){var t=this,r=this.unitLabel();return m(".FlamarktDecimalInput.FormControl",{className:l()(this.className())},[m("input",this.inputAttrs()),r?m(".FlamarktDecimalInputUnit",{onclick:function(){t.$("input").focus()}},r):null])},r}(s()),p=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.decimals=function(){return this.attrs.decimals||0},n.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},n.view=function(){return this.fromIntegerValue(this.attrs.value).toFixed(this.decimals())},r}(s());const f=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/AbstractSortDropdown"];var h=t.n(f),y=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"OrderSortDropdown"},n.options=function(){return{"-createdAt":"Newest",createdAt:"Oldest","-priceTotal":"Highest total",priceTotal:"Lowest total"}},r}(h());const v=flarum.core.compat["common/app"];var b=t.n(v),g=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.decimals=function(){return b().forum.attribute("priceDecimals")},n.className=function(){return["FlamarktPriceInput"].concat(t.prototype.className.call(this))},n.unitLabel=function(){return b().forum.attribute("priceUnit")},r}(d),w=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.decimals=function(){return b().forum.attribute("priceDecimals")},n.view=function(){return[t.prototype.view.call(this)," ",b().forum.attribute("priceUnit")]},r}(p),k=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"ProductSortDropdown"},n.options=function(){return{"-createdAt":b().translator.trans("flamarkt-core.lib.sort.products.createdAtDesc"),createdAt:b().translator.trans("flamarkt-core.lib.sort.products.createdAtAsc"),price:b().translator.trans("flamarkt-core.lib.sort.products.priceAsc"),"-price":b().translator.trans("flamarkt-core.lib.sort.products.priceDesc"),title:b().translator.trans("flamarkt-core.lib.sort.products.titleAsc"),"-title":b().translator.trans("flamarkt-core.lib.sort.products.titleDesc")}},r}(h()),P=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r}(d),A=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r}(p);function T(t){return t===parseInt(t)&&(t=(t/Math.pow(10,b().forum.attribute("priceDecimals"))).toFixed(b().forum.attribute("priceDecimals"))),[t," "+b().forum.attribute("priceUnit")]}const C=flarum.core.compat["common/Model"];var S=t.n(C),N=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).productCount=S().attribute("productCount"),r.priceTotal=S().attribute("priceTotal"),r.products=S().hasMany("products"),r}i(r,t);var n=r.prototype;return n.priceTotalLocal=function(){return(this.products()||[]).reduce((function(t,r){return t+(r?r.cartPriceTotalLocal():0)}),0)},n.apiEndpoint=function(){return"/flamarkt/carts"+(this.exists?"/"+this.data.id:"")},r}(S());const I={defaultFormat:function(){return"YYYY-MM-DD"},orderDayFormat:function(){return this.defaultFormat()},paymentDayFormat:function(){return this.defaultFormat()}};var D=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).number=S().attribute("number"),r.slug=S().attribute("slug"),r.productCount=S().attribute("productCount"),r.priceTotal=S().attribute("priceTotal"),r.paidAmount=S().attribute("paidAmount"),r.createdAt=S().attribute("createdAt",S().transformDate),r.isHidden=S().attribute("isHidden"),r.user=S().hasOne("user"),r.lines=S().hasMany("lines"),r.payments=S().hasMany("payments"),r}i(r,t);var n=r.prototype;return n.titleDate=function(){var t=this.createdAt();return t?dayjs(t).format(I.orderDayFormat()):"<not dated>"},n.apiEndpoint=function(){return"/flamarkt/orders"+(this.exists?"/"+this.data.id:"")},r}(S()),Q=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).number=S().attribute("number"),r.group=S().attribute("group"),r.type=S().attribute("type"),r.label=S().attribute("label"),r.comment=S().attribute("comment"),r.quantity=S().attribute("quantity"),r.priceUnit=S().attribute("priceUnit"),r.priceTotal=S().attribute("priceTotal"),r.product=S().hasOne("product"),r}return i(r,t),r}(S()),q=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).method=S().attribute("method"),r.identifier=S().attribute("identifier"),r.amount=S().attribute("amount"),r.createdAt=S().attribute("createdAt",S().transformDate),r.isHidden=S().attribute("isHidden"),r}return i(r,t),r.prototype.apiEndpoint=function(){return"/flamarkt/payments"+(this.exists?"/"+this.data.id:"")},r}(S()),L=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).title=S().attribute("title"),r.slug=S().attribute("slug"),r.description=S().attribute("description"),r.descriptionHtml=S().attribute("descriptionHtml"),r.price=S().attribute("price"),r.priceEdit=S().attribute("priceEdit"),r.cartQuantity=S().attribute("cartQuantity"),r.isHidden=S().attribute("isHidden"),r.canOrder=S().attribute("canOrder"),r.canEdit=S().attribute("canEdit"),r}i(r,t);var n=r.prototype;return n.cartPriceTotalLocal=function(){return this.price&&this.cartQuantity?this.price()*this.cartQuantity():0},n.apiEndpoint=function(){return"/flamarkt/products"+(this.exists?"/"+this.data.id:"")},r}(S());const x=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var O=t.n(x),F=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.type=function(){return"flamarkt/orders"},r}(O()),R=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.type=function(){return"flamarkt/products"},r}(O()),B={"components/DecimalInput":d,"components/DecimalLabel":p,"components/OrderSortDropdown":y,"components/PriceInput":g,"components/PriceLabel":w,"components/ProductSortDropdown":k,"components/QuantityInput":P,"components/QuantityLabel":A,"helpers/formatPrice":T,"models/Cart":N,"models/Order":D,"models/OrderLine":Q,"models/Payment":q,"models/Product":L,"states/OrderListState":F,"states/ProductListState":R};const H=flarum.core.compat["common/helpers/listItems"];var E=t.n(H),M=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("ul.Breadcrumb",E()(this.items().toArray()))},n.items=function(){return this.attrs.items},r}(s());const U=flarum.core.compat["common/components/Dropdown"];var _=t.n(U);const V=flarum.core.compat["common/helpers/icon"];var j=t.n(V);const K=flarum.core.compat["common/utils/extractText"];var G=t.n(K);const Y=flarum.core.compat["common/components/LinkButton"];var z=t.n(Y);const W=flarum.core.compat["common/utils/ItemList"];var J=t.n(W),X=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).attrs=void 0,r}i(r,t);var n=r.prototype;return n.view=function(){return m(".CartDropdownList",this.items().toArray())},n.items=function(){var t=new(J());return t.add("products",m("p",e().translator.trans("flamarkt-core.forum.cartDropdown.products",{count:this.attrs.state.productCount()||0})),10),t.add("link",z().component({className:"Button Button--primary Button--block",href:e().route("flamarkt.cart")},e().translator.trans("flamarkt-core.forum.cartDropdown.action")),-10),t},r}(s()),Z=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).attrs=void 0,r}i(r,t),r.initAttrs=function(r){r.className=r.className||"CartDropdown",r.buttonClassName=r.buttonClassName||"Button Button--flat",r.menuClassName=r.menuClassName||"Dropdown-menu--right",r.label=r.label||G()(e().translator.trans("flamarkt-core.forum.cartDropdown.label")),t.initAttrs.call(this,r)};var n=r.prototype;return n.getButton=function(t){return m("a.Dropdown-toggle",{className:this.attrs.buttonClassName,"data-toggle":"dropdown",onclick:this.onclick.bind(this),title:this.attrs.label,href:e().route("flamarkt.cart")},this.getButtonContent(t))},n.getButtonContent=function(t){var r="fas fa-shopping-cart";return this.attrs.state.loading&&(r="fas fa-spinner fa-pulse"),[j()(r,{className:"Button-icon"}),m("span.Button-label",m(w,{value:this.attrs.state.priceTotal()||0,hint:"cart dropdown"}))]},n.getMenu=function(){return m(".Dropdown-menu",{className:this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?X.component({state:this.attrs.state}):null)},n.onclick=function(t){t.preventDefault(),e().drawer.isOpen()?this.goToRoute():this.showing||this.attrs.state.load()},n.goToRoute=function(){m.route.set(e().route("flamarkt.cart"))},n.menuClick=function(t){(t.shiftKey||t.metaKey||t.ctrlKey||2===t.which)&&t.stopPropagation()},r}(_()),tt=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.view=function(t){return m("section",{className:"CartPage-section "+t.attrs.className},[m("h3",t.attrs.title),t.children])},r}(s());const rt=flarum.core.compat["common/components/Button"];var nt=t.n(rt);const et=flarum.core.compat["common/components/Link"];var ot=t.n(et);const at=flarum.core.compat["common/components/Tooltip"];var it=t.n(at);const ut=flarum.core.compat["common/components/LoadingIndicator"];var st=t.n(ut),ct=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(t){return m("span.FlamarktInlineSubmitStatus",{className:l()({success:"success"===this.attrs.result,error:"error"===this.attrs.result})},this.content())},n.content=function(){if(this.attrs.loading)return st().component({display:"inline",size:"small"});switch(this.attrs.result){case"success":return j()("fas fa-check");case"error":return j()("fas fa-times")}return null},r}(s()),lt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).quantity=0,r.savedQuantity=0,r.quantitySaving=!1,r.quantitySaveResult=null,r.quantityChangeDebounce=0,r}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.savedQuantity=this.attrs.product.cartQuantity()||0,this.quantity=this.savedQuantity},n.view=function(){var t=this.attrs.product.cartQuantity()||0;return t!==this.savedQuantity&&(this.savedQuantity=t,this.quantity=t,clearTimeout(this.quantityChangeDebounce),this.quantityChangeDebounce=0),m("tr",this.columns().toArray())},n.columns=function(){var t=this,r=new(J()),n=this.attrs.product;return r.add("product",m("td",m(ot(),{href:e().route.product(n)},n.title())),200),r.add("quantity",m("td",[m(P,{className:"CartTableQuantity",value:this.quantity,onchange:function(r){t.quantity=r,clearTimeout(t.quantityChangeDebounce),t.quantityChangeDebounce=0,t.quantityChangeDebounce=setTimeout((function(){t.quantityChangeDebounce=0,t.submitQuantity(r),m.redraw()}),500)},product:n,min:0,disabled:this.quantityEditDisabled()}),m(ct,{loading:this.inlineLoading(),result:this.inlineResult()})]),100),r.add("total",m("td",m(w,{value:n.cartPriceTotalLocal(),hint:"cart product total",product:n})),-100),r.add("delete",m("td",it().component({text:this.deleteTooltipText()},nt().component({className:"Button Button--icon",icon:"fas fa-times",disabled:this.deleteDisabled(),onclick:function(){t.submitQuantity(0)}}))),-200),r},n.inlineLoading=function(){return this.quantitySaving||this.quantityChangeDebounce>0},n.inlineResult=function(){return this.quantitySaveResult},n.quantityEditDisabled=function(){return!this.attrs.product.canOrder()},n.deleteDisabled=function(){return!this.attrs.product.canOrder()},n.deleteTooltipText=function(){return"Remove from cart"},n.submitQuantity=function(t){this.quantitySaving=!0,this.quantitySaveResult=null,this.attrs.product.save({cartQuantity:t}).then(this.submitQuantityDone.bind(this)).catch(this.submitQuantityError.bind(this))},n.submitQuantityDone=function(t){var r=this;this.savedQuantity=t.cartQuantity()||0,this.quantity=this.savedQuantity,this.quantitySaving=!1,this.quantitySaveResult="success",setTimeout((function(){r.quantitySaveResult=null,m.redraw()}),2e3),m.redraw(),0===this.quantity&&e().cart.load()},n.submitQuantityError=function(t){var r=this;throw this.quantitySaving=!1,this.quantitySaveResult="error",setTimeout((function(){r.quantitySaveResult=null,m.redraw()}),5e3),m.redraw(),t},r}(s()),mt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("table.CartTable",[m("thead",m("tr",this.head().toArray())),m("tbody",this.rows().toArray())])},n.head=function(){var t=new(J());return t.add("product",m("th","Product"),200),t.add("quantity",m("th","Quantity"),100),t.add("total",m("th","Total"),-100),t.add("actions",m("th"),-200),t},n.rows=function(){var t=this,r=new(J()),n=this.attrs.cart.products()||[];return n.forEach((function(n){n&&r.add(t.productRowKey(n),lt.component({product:n}),t.productRowPriority(n))})),0===n.length?r.add("empty",m("tr",m("td",{colspan:100},"Cart is empty")),-100):r.add("total",m("tr",[m("th",{colspan:2},"Total"),m("th",m(w,{value:this.attrs.cart.priceTotalLocal(),hint:"cart total"})),m("th")]),-100),r},n.productRowKey=function(t){return"product-"+t.id()},n.productRowPriority=function(t){return 0},r}(s()),dt=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.view=function(t){return m(".FlamarktOrderFact",{className:this.attrs.className},m("dl",[m("dt",this.attrs.title),t.children]))},r}(s()),pt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("dd.FlamarktOrderFactPayment",this.items().toArray())},n.items=function(){var t=new(J()),r=this.date();r&&t.add("date",m("span.date",[r," "]),30);var n=this.amount();n&&t.add("amount",m("span.amount",[n," "]),20);var e=this.label();return e&&t.add("label",m("span.label",[e," "]),10),t},n.date=function(){var t=dayjs(this.attrs.payment.createdAt());return m("time",{datetime:t.format(),title:t.format("LLLL")},t.format(I.paymentDayFormat()))},n.label=function(){return m("code",this.attrs.payment.method())},n.amount=function(){return m(w,{value:this.attrs.payment.amount()})},r}(s()),ft=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){var t=this.items().toArray();return t.length>0?m(".FlamarktOrderFacts",t):null},n.items=function(){var t=new(J()),r=this.shippingInformation().toArray();r.length&&t.add("shipping",m(dt,{title:"Shipping",className:"FlamarktOrderFact--shipping"},this.wrapContent.apply(this,r)),100);var n=this.paymentInformation().toArray();return n.length&&t.add("payment",m(dt,{title:"Payment status",className:"FlamarktOrderFact--payment"},this.wrapContent.apply(this,n)),50),t},n.shippingInformation=function(){return new(J())},n.paymentInformation=function(){var t=this,r=new(J());return(this.attrs.order.payments()||[]).forEach((function(n){n&&t.paymentVisible(n)&&r.add("payment-"+n.id(),m(pt,{payment:n}),10)})),r},n.paymentVisible=function(t){return!0},n.dontWrapContent=function(t){return"dd"===t.tag||t.tag===pt},n.wrapContent=function(){for(var t=this,r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];return n.map((function(r){return r&&"object"==typeof r&&!Array.isArray(r)&&t.dontWrapContent(r)?r:m("dd",r)}))},r}(s()),ht=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("tr",this.columns().toArray())},n.columns=function(){var t=new(J()),r=this.attrs.line,n=r.product();return t.add("number",m("td",r.number()),100),t.add("product",m("td",this.productContent()),30),t.add("priceUnit",m("td",m(w,{value:r.priceUnit(),product:n,hint:"order line unit"})),-30),t.add("quantity",m("td",m(A,{value:r.quantity(),product:n})),-60),t.add("priceTotal",m("td",m(w,{value:r.priceTotal(),hint:"order line total",product:n})),-90),t},n.productContent=function(){return[this.labelContent(),this.commentContent()]},n.labelContent=function(){var t=this.attrs.line,r=t.product();return"product"===t.type()&&r?m(ot(),{href:e().route.product(r)},r.title()):t.label()||m("em","N/A")},n.commentContent=function(){var t=this.attrs.line;return t.comment()?m(".comment",t.comment()):null},r}(s()),yt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return this.visible()?m("tr",this.columns().toArray()):null},n.visible=function(){return!1},n.columns=function(){var t=new(J());return t.add("number",m("th"),100),t.add("product",m("th"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th"),-90),t},r}(s()),vt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return this.visible()?m("tr",this.columns().toArray()):null},n.visible=function(){return(this.attrs.order.lines()||[]).some((function(t){return t&&null!==t.group()}))&&"default"===this.attrs.group},n.subtotal=function(){return this.attrs.lines.reduce((function(t,r){return t+(r.priceTotal()||0)}),0)},n.columns=function(){var t=new(J());return t.add("number",m("th"),100),t.add("product",m("th","Subtotal"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th",m(w,{value:this.subtotal(),hint:"order group subtotal"})),-90),t},r}(s()),bt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("table.CartTable",[m("thead",m("tr",this.head().toArray())),m("tbody",this.rows().toArray()),m("tfoot",m("tr",this.foot().toArray()))])},n.head=function(){var t=new(J());return t.add("number",m("th"),100),t.add("product",m("th","Product"),30),t.add("priceUnit",m("th","Price"),-30),t.add("quantity",m("th","Quantity"),-60),t.add("priceTotal",m("th","Total"),-90),t},n.foot=function(){var t=new(J());return t.add("number",m("th"),100),t.add("product",m("th","Total"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th",m(w,{value:this.attrs.order.priceTotal(),hint:"order foot total"})),-90),t},n.rows=function(){var t=this,r=new(J()),n=this.attrs.order,e=!0,o="__not_exists",a=[];return(n.lines()||[]).forEach((function(i){if(i){var u=i.group()||"default";u!==o&&(e||r.add("group-foot-"+o,m(vt,{group:o,lines:a,order:n}),t.lineFootPriority(o)),o=u,a=[],r.add("group-head-"+o,m(yt,{group:o,line:[],order:n}),t.lineHeadPriority(o))),r.add(t.lineKey(i),ht.component({line:i,order:n}),t.linePriority(i)),a.push(i),e=!1}})),e||r.add("group-foot-"+o,m(vt,{group:o,lines:a,order:n}),this.lineFootPriority(o)),r},n.lineKey=function(t){return"line-"+t.id()},n.linePriority=function(t){return 0},n.lineHeadPriority=function(t){return 0},n.lineFootPriority=function(t){return 0},r}(s()),gt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m("li.ProductListItem",this.link(this.items().toArray()))},n.link=function(t){return m(ot(),{className:"ProductListItem--link",href:e().route.product(this.attrs.product)},t)},n.items=function(){var t=new(J()),r=this.attrs.product;return t.add("price",m("span.ProductListItem--price",T(r.price())),20),t.add("title",m("span.ProductListItem--title",r.title()),10),t},r}(s()),wt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).cartQuantity=1,r.savingQuantity=!1,r}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.cartQuantity=this.attrs.product.cartQuantity()||1},n.view=function(){var t=this,r=this.attrs.product;return m(".ProductQuantity",[m(P,{value:this.cartQuantity,onchange:function(r){t.cartQuantity=r},product:r,min:0}),nt().component({className:"Button Button--primary Button--block",disabled:this.cartQuantity===r.cartQuantity(),loading:this.savingQuantity,onclick:function(){t.savingQuantity=!0,r.save({cartQuantity:t.cartQuantity}).then((function(){t.savingQuantity=!1,t.cartQuantity=r.cartQuantity()||1,m.redraw(),e().cart.load()})).catch((function(r){throw t.savingQuantity=!1,m.redraw(),r}))}},e().translator.trans(r.cartQuantity()?"flamarkt-core.forum.product.updateCartQuantity":"flamarkt-core.forum.product.addToCart")),r.cartQuantity()?nt().component({className:"Button Button--block",loading:this.savingQuantity,onclick:function(){t.savingQuantity=!0,r.save({cartQuantity:0}).then((function(){t.savingQuantity=!1,t.cartQuantity=1,m.redraw(),e().cart.load()})).catch((function(r){throw t.savingQuantity=!1,m.redraw(),r}))}},e().translator.trans("flamarkt-core.forum.product.removeFromCart")):null])},r}(s());const kt=flarum.core.compat["common/helpers/highlight"];var Pt=t.n(kt),At=function(){function t(){this.results=new Map}var r=t.prototype;return r.search=function(t){var r=this;return e().store.find("flamarkt/products",{filter:{q:t},page:{limit:5}}).then((function(n){r.results.set(t,n),m.redraw()}))},r.view=function(t){var r=this;t=t.toLowerCase();var n=(this.results.get(t)||[]).map((function(n){return m("li.UserSearchResult",{"data-index":"products"+n.id()},m(ot(),{href:e().route.product(n)},r.product(n,t).toArray()))}));return[m("li.Dropdown-header",e().translator.trans("flamarkt-core.forum.search.products.heading")),m("li",z().component({icon:"fas fa-search",href:e().route("flamarkt.products.index",{q:t})},e().translator.trans("flamarkt-core.forum.search.products.all",{query:t})))].concat(n)},r.product=function(t,r){var n=new(J());return n.add("title",Pt()(t.title(),r)),n},t}();const Tt=flarum.core.compat["forum/components/IndexPage"];var Ct=t.n(Tt),St=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).attrs=void 0,r}i(r,t);var n=r.prototype;return n.view=function(t){var r=this.className();return m(".ShopPage",{className:r||void 0},[Ct().prototype.hero(),m(".container",m(".sideNavContainer",[m("nav.IndexPage-nav.ShopPage-nav.sideNav",m("ul",E()(this.sidebarItems().toArray()))),m(".ShopPage-content.sideNavOffset",[M.component({items:this.breadcrumbItems()}),this.contentTitle(),this.content(t)])]))])},n.sidebarItems=function(){return Ct().prototype.sidebarItems()},n.breadcrumbItems=function(){var t=new(J());"/"!==this.currentPageHref()&&t.add("home",z().component({href:"/"},"Home"),100);var r=this.title();return r&&t.add("current",m("span.breadcrumb-current",r),-100),t},n.className=function(){return""},n.title=function(){return""},n.currentPageHref=function(){return null},n.contentTitle=function(){var t=this.title();return t?m("h1",t):null},r}(s()),Nt=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return this.currentPageHref()!==e().route("flamarkt.account")&&r.add("account",z().component({href:e().route("flamarkt.account")},"Account")),r},r}(St);const It={controls:function(t){var r=new(J());return r.add("orders",z().component({href:e().route("flamarkt.account.orders")},"Orders"),10),r.add("settings",z().component({href:e().route("settings")},"Settings"),-10),r}};var Dt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"AccountPage"},n.title=function(){return e().translator.trans("flamarkt-core.forum.account.headingTitle")},n.currentPageHref=function(){return e().route("flamarkt.account")},n.content=function(){return e().session.user?m("ul",E()(It.controls(e().session.user).toArray())):null},r}(Nt),Qt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).submitting=!1,r}i(r,t);var n=r.prototype;return n.className=function(){return"CartPage"},n.title=function(){return e().translator.trans("flamarkt-core.forum.cart.headingTitle")},n.content=function(){var t=this.attrs.cart;return t?t.exists?m("form",{onsubmit:this.onsubmit.bind(this)},this.sections().toArray()):"No cart":st().component()},n.sectionProducts=function(){var t=new(J());return t.add("table",mt.component({cart:this.attrs.cart})),t},n.sectionPayment=function(){return new(J())},n.sections=function(){var t=new(J());t.add("products",tt.component({className:"CartPage-products",title:"Products"},this.sectionProducts().toArray()));var r=this.sectionPayment().toArray();return r.length&&t.add("payment",tt.component({className:"CartPage-payment",title:"Payment"},r)),t.add("submit",m(".Form-group",nt().component({type:"submit",className:"Button Button--primary",loading:this.submitting},"Place order"))),t},n.data=function(){return{relationships:{cart:this.attrs.cart}}},n.onsubmit=function(t){t.preventDefault(),this.submitting=!0,e().store.createRecord("flamarkt-orders").save(this.data()).then(this.afterSuccessfulSubmit.bind(this)).catch(this.afterFailedSubmit.bind(this))},n.afterSuccessfulSubmit=function(t){e().store.all("flamarkt-products").forEach((function(t){t.pushAttributes({cartQuantity:null})})),m.route.set(e().route.order(t)),e().cart.load()},n.afterFailedSubmit=function(t){throw this.submitting=!1,m.redraw(),t},r}(St);const qt=flarum.core.compat["common/helpers/humanTime"];var Lt=t.n(qt);const xt=flarum.core.compat["common/components/Placeholder"];var Ot=t.n(xt),Ft=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"OrderIndexPage"},n.title=function(){return e().translator.trans("flamarkt-core.forum.orders.headingTitle")},n.content=function(){var t=this;return m("div",[m(".Form-group",[m(y,{list:this.attrs.state})]),m("table.CartTable",[m("thead",m("tr",this.headerRow().toArray())),m("tbody",[this.attrs.state.pages.map((function(r){return r.items.map((function(r){return m("tr",t.orderRow(r).toArray())}))})),this.bottomRow()])])])},n.headerRow=function(){var t=new(J());return t.add("number",m("th","#"),40),t.add("createdAt",m("th","Date"),30),t.add("productCount",m("th","Products"),20),t.add("priceTotal",m("th","Total"),10),t},n.orderRow=function(t){var r=new(J());return r.add("number",m("td",m(ot(),{href:e().route.order(t)},t.number())),40),r.add("createdAt",m("td",Lt()(t.createdAt())),30),r.add("productCount",m("td",t.productCount()),20),r.add("priceTotal",m("td",m(w,{value:t.priceTotal()})),10),r},n.bottomRowContent=function(){return this.attrs.state.loading?st().component():this.attrs.state.moreResults?nt().component({className:"Button Button--block",onclick:this.attrs.state.loadMore.bind(this.attrs.state)},"Load more"):0!==this.attrs.state.pages.length||this.attrs.state.loading?void 0:Ot().component({text:"No orders yet"})},n.bottomRow=function(){var t=this.bottomRowContent();return t?m("tr",m("td",{colspan:100},t)):null},r}(Nt),Rt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"OrderShowPage"},n.title=function(){return this.attrs.order?e().translator.trans("flamarkt-core.forum.order.headingTitle",{number:this.attrs.order.number(),date:this.attrs.order.titleDate()}):"Order"},n.content=function(){return this.attrs.order?this.sections().toArray():st().component()},n.sections=function(){var t=new(J()),r=this.attrs.order;return e().forum.attribute("backofficeUrl")&&t.add("edit",z().component({className:"Button",href:e().forum.attribute("backofficeUrl")+"/orders/"+r.id(),external:!0},"Edit"),200),t.add("facts",ft.component({order:r}),20),t.add("table",bt.component({order:r}),10),t},r}(Nt),Bt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.className=function(){return"ProductIndexPage"},n.title=function(){return"/"===this.currentPageHref()?"Home":e().translator.trans("flamarkt-core.forum.products.headingTitle")},n.currentPageHref=function(){return e().route("flamarkt.products.index")},n.contentTitle=function(){return"/"===this.currentPageHref()?null:t.prototype.contentTitle.call(this)},n.content=function(){return[m(".ProductListFilters",this.filters().toArray()),m("ul.ProductList",this.attrs.state.pages.map((function(t){return t.items.map((function(t){return gt.component({product:t})}))}))),this.bottomControls()]},n.bottomControls=function(){return this.attrs.state.loading?st().component():this.attrs.state.moreResults?nt().component({className:"Button",onclick:this.attrs.state.loadMore.bind(this.attrs.state)},"Load more"):0!==this.attrs.state.pages.length||this.attrs.state.loading?void 0:Ot().component({text:"No results"})},n.filters=function(){var t=new(J());return t.add("sort",m(k,{list:this.attrs.state,updateUrl:!0})),t},r}(St),Ht=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return r.add("products",z().component({href:e().route("flamarkt.products.index")},e().translator.trans("flamarkt-core.forum.breadcrumb.products"))),r},n.className=function(){return"ProductShowPage"},n.product=function(){return this.attrs.product},n.title=function(){var t=this.product();return t?t.title():""},n.contentTitle=function(){return null},n.content=function(){var t=this.product();return t?this.loadedContent(t):this.loadingContent()},n.loadingContent=function(){return st().component({className:"LoadingIndicator--block"})},n.loadedContent=function(t){return m(".ProductShowSections",m.fragment({key:t.id()},this.sections(t).toArray()))},n.sections=function(t){var r=new(J()),n=this.gallerySection(t).toArray();return n.length&&r.add("gallery",m("section.ProductShowSection.ProductShowSection--gallery",n),30),r.add("price",m("section.ProductShowSection.ProductShowSection--price",this.priceSection(t).toArray()),20),r.add("description",m("section.ProductShowSection.ProductShowSection--description",this.descriptionSection(t).toArray()),10),r},n.gallerySection=function(t){return new(J())},n.priceSection=function(t){var r=new(J());return t.canEdit()&&r.add("edit",z().component({className:"Button",href:e().forum.attribute("backofficeUrl")+"/products/"+t.id(),external:!0},"Edit"),200),r.add("title",m("h1",t.title()),100),r.add("price",m("p",m(w,{value:t.price(),hint:"product"})),50),this.showCartControls(t)&&r.add("quantity",wt.component({product:t}),20),r},n.showCartControls=function(t){return!!t.canOrder()},n.descriptionSection=function(t){var r=new(J()),n=t.descriptionHtml();return n&&r.add("description",m("div",m.trust(n)),10),r},r}(St);const Et=flarum.core.compat["common/components/Page"];var Mt=t.n(Et),Ut=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.view=function(){return m(".ShopPage",[Ct().prototype.hero(),m(".container",m(".sideNavContainer",[m("nav.ShopPage-nav.sideNav",m("ul",E()(this.sidebarItems().toArray()))),m(".ShopPage-content.sideNavOffset",[M.component({items:this.breadcrumbItems()}),this.content()])]))])},n.sidebarItems=function(){return Ct().prototype.sidebarItems()},n.breadcrumbItems=function(){var t=new(J());return t.add("home",z().component({href:e().route("index")},"Home"),100),t},r}(Mt()),_t=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return r.add("account",z().component({href:e().route("flamarkt.account")},"Account")),r},r}(Ut),Vt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.oncreate=function(r){t.prototype.oncreate.call(this,r),e().setTitle(G()(e().translator.trans("flamarkt-core.forum.account.browserTitle"))),e().setTitleCount(0)},n.view=function(){return Dt.component()},r}(Mt()),jt=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),e().cart.load(),e().setTitle(G()(e().translator.trans("flamarkt-core.forum.cart.browserTitle"))),e().setTitleCount(0)},n.view=function(){var t;return t=e().cart.loading?null:e().cart.cart?e().cart.cart:e().store.createRecord("flamarkt-carts"),Qt.component({cart:t})},r}(Mt()),Kt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).state=void 0,r}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.state=this.initState(),this.state.refresh(),e().setTitle(G()(e().translator.trans("flamarkt-core.forum.orders.browserTitle"))),e().setTitleCount(0)},n.initState=function(){return new F({filter:{user:e().session.user?e().session.user.id():0}})},n.view=function(){return Ft.component({state:this.state})},r}(Mt());const Gt=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["pages/AbstractShowPage"];var Yt=t.n(Gt),zt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).order=null,r}i(r,t);var n=r.prototype;return n.findType=function(){return"flamarkt/orders"},n.requestParams=function(){var r=t.prototype.requestParams.call(this);return r.bySlug=!0,r},n.show=function(t){this.order=t,e().setTitle(G()(e().translator.trans("flamarkt-core.forum.order.browserTitle",{number:this.order.number(),date:this.order.titleDate()}))),e().setTitleCount(0)},n.view=function(){return Rt.component({order:this.order})},r}(Yt()),Wt=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.limit=function(){return 24},r}(R),$t=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).state=void 0,r}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.state=this.initState(),this.state.refresh(),e().setTitle(G()(e().translator.trans("flamarkt-core.forum.products.browserTitle"))),e().setTitleCount(0)},n.initState=function(){var t=m.route.param();return new Wt({sort:t.sort,q:t.q})},n.view=function(){return Bt.component({state:this.state})},r}(Mt()),Jt=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).product=null,r}i(r,t);var n=r.prototype;return n.oninit=function(r){this.bodyClass="App--product",t.prototype.oninit.call(this,r)},n.findType=function(){return"flamarkt/products"},n.requestParams=function(){var r=t.prototype.requestParams.call(this);return r.bySlug=!0,r},n.show=function(t){this.product=t,e().setTitle(t.title()),e().setTitleCount(0)},n.view=function(){return Ht.component({product:this.product})},r}(Yt()),Xt=function(){function t(){this.cart=null,this.loading=!1}var r=t.prototype;return r.priceTotal=function(){return this.cart?this.cart.priceTotal():null},r.productCount=function(){return this.cart?this.cart.productCount():null},r.boot=function(){this.cart=e().forum.cart()||null},r.request=function(){return e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/flamarkt/cart"}).then((function(t){return e().store.pushPayload(t)}))},r.setCart=function(t){this.loading=!1,this.cart=t},r.load=function(){var t=this;return this.loading=!0,this.request().then((function(r){t.setCart(r),m.redraw()})).catch((function(r){throw t.loading=!1,m.redraw(),r}))},t}(),Zt={"components/Breadcrumb":M,"components/CartDropdown":Z,"components/CartList":X,"components/CartPageSection":tt,"components/CartTable":mt,"components/CartTableRow":lt,"components/InlineSubmitStatus":ct,"components/OrderFact":dt,"components/OrderFactPayment":pt,"components/OrderFacts":ft,"components/OrderTable":bt,"components/OrderTableGroupFoot":vt,"components/OrderTableGroupHead":yt,"components/OrderTableRow":ht,"components/ProductListItem":gt,"components/ProductQuantity":wt,"components/ProductSearchSource":At,"layouts/AbstractAccountLayout":Nt,"layouts/AbstractShopLayout":St,"layouts/AccountLayout":Dt,"layouts/CartLayout":Qt,"layouts/OrderIndexLayout":Ft,"layouts/OrderShowLayout":Rt,"layouts/ProductIndexLayout":Bt,"layouts/ProductShowLayout":Ht,"pages/AbstractAccountPage":_t,"pages/AbstractShopPage":Ut,"pages/AccountPage":Vt,"pages/CartPage":jt,"pages/OrderIndexPage":Kt,"pages/OrderShowPage":zt,"pages/ProductIndexPage":$t,"pages/ProductShowPage":Jt,"states/CartState":Xt,"states/ProductGridListState":Wt,"utils/AccountControls":It,"utils/DateFormat":I};const tr=flarum.core.compat["common/models/Forum"];var rr=t.n(tr);const nr=flarum.core.compat["forum/components/HeaderSecondary"];var er=t.n(nr);const or=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/ActiveLinkButton"];var ar=t.n(or);const ir=flarum.core.compat["forum/components/NotificationGrid"];var ur=t.n(ir);const sr=flarum.core.compat["forum/components/Search"];var cr=t.n(sr);const lr=flarum.core.compat["forum/ForumApplication"];var mr=t.n(lr);e().initializers.add("flamarkt-core",(function(){var t;b().store.models["flamarkt-carts"]=N,b().store.models["flamarkt-orders"]=D,b().store.models["flamarkt-order-lines"]=Q,b().store.models["flamarkt-payments"]=q,b().store.models["flamarkt-products"]=L,rr().prototype.cart=S().hasOne("cart"),(t=e()).routes["flamarkt.account"]={path:"/account",component:Vt},t.routes["flamarkt.account.orders"]={path:"/account/orders",component:Kt},t.routes["flamarkt.cart"]={path:"/cart",component:jt},t.routes["flamarkt.products.index"]={path:"/products",component:$t},t.routes["flamarkt.products.show"]={path:"/products/:id",component:Jt},t.routes["flamarkt.orders.show"]={path:"/orders/:id",component:zt},t.route.product=function(r){return t.route("flamarkt.products.show",{id:r.slug()})},t.route.order=function(r){return t.route("flamarkt.orders.show",{id:r.slug()})},e().cart=new Xt,(0,o.extend)(mr().prototype,"mount",(function(){e().cart.boot(),$("#home-link").click((function(t){t.ctrlKey||t.metaKey||2===t.which||e().session.user&&e().cart.load()}))})),(0,o.extend)(Ct().prototype,"navItems",(function(t){t.add("flamarkt-products",ar().component({icon:"fas fa-shopping-cart",href:e().route("flamarkt.products.index"),activeRoutes:["flamarkt.products.*"]},e().translator.trans("flamarkt-core.forum.nav.shop"))),t.add("flamarkt-account",ar().component({icon:"fas fa-user",href:e().route("flamarkt.account"),activeRoutes:["flamarkt.account.*","flamarkt.orders.show"]},e().translator.trans("flamarkt-core.forum.nav.account")))})),(0,o.extend)(er().prototype,"items",(function(t){t.add("flamarkt-cart",Z.component({state:e().cart}),15)})),(0,o.extend)(ur().prototype,"notificationTypes",(function(t){t.add("orderReceived",{name:"orderReceived",icon:"far fa-thumbs-up",label:e().translator.trans("flamarkt-core.forum.settings.notifyOrderReceived")})})),(0,o.override)(ur().prototype,"preferenceKey",(function(t,r,n){return"orderReceived"===r&&"alert"===n?"__not_exists":t(r,n)})),(0,o.extend)(cr().prototype,"sourceItems",(function(t){t.add("products",new At,-10)}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map