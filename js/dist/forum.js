module.exports=function(t){var r={};function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(n,o,function(r){return t[r]}.bind(null,o));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=29)}([function(t,r){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,r){t.exports=flarum.core.compat["common/Component"]},function(t,r){t.exports=flarum.core.compat["forum/app"]},function(t,r){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,r){t.exports=flarum.core.compat["common/components/Button"]},function(t,r){t.exports=flarum.core.compat["common/extend"]},function(t,r){t.exports=flarum.core.compat["common/Model"]},function(t,r){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,r){t.exports=flarum.core.compat["common/components/Page"]},function(t,r){t.exports=flarum.core.compat["common/components/Link"]},function(t,r){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,r){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,r){t.exports=flarum.core.compat["common/helpers/highlight"]},function(t,r){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,r){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,r){t.exports=flarum.core.compat["common/components/Placeholder"]},function(t,r){t.exports=flarum.core.compat["common/components/Select"]},function(t,r){t.exports=flarum.core.compat["forum/components/NotificationGrid"]},function(t,r){t.exports=flarum.core.compat["forum/components/SessionDropdown"]},function(t,r){t.exports=flarum.core.compat["common/helpers/humanTime"]},function(t,r){t.exports=flarum.core.compat["common/utils/classList"]},function(t,r){t.exports=flarum.core.compat["common/helpers/username"]},function(t,r){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,r){t.exports=flarum.core.compat["common/models/Forum"]},function(t,r){t.exports=flarum.core.compat["forum/components/HeaderSecondary"]},function(t,r){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,r){t.exports=flarum.core.compat["forum/components/Search"]},,,function(t,r,e){"use strict";e.r(r),e.d(r,"common",(function(){return W})),e.d(r,"forum",(function(){return cr}));var n=e(2),o=e.n(n),a=e(5),i=e(18),s=e.n(i),u=e(3),c=e.n(u);function l(t,r){return(l=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}function p(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,l(t,r)}var d=e(6),h=e.n(d),f=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.attribute=function(t,r){return h.a.attribute(t,r)},r.hasOne=function(t){return h.a.hasOne(t)},r.hasMany=function(t){return h.a.hasMany(t)},r}(h.a),v=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).productCount=f.attribute("productCount"),r.priceTotal=f.attribute("priceTotal"),r.products=f.hasMany("products"),r}p(r,t);var e=r.prototype;return e.priceTotalLocal=function(){return(this.products()||[]).reduce((function(t,r){return t+r.cartPriceTotalLocal()}),0)},e.apiEndpoint=function(){return"/flamarkt/carts"+(this.exists?"/"+this.data.id:"")},r}(f),y=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).number=f.attribute("number"),r.slug=f.attribute("slug"),r.productCount=f.attribute("productCount"),r.priceTotal=f.attribute("priceTotal"),r.paidAmount=f.attribute("paidAmount"),r.createdAt=f.attribute("createdAt",f.transformDate),r.isHidden=f.attribute("isHidden"),r.user=f.hasOne("user"),r.lines=f.hasMany("lines"),r.payments=f.hasMany("payments"),r}return p(r,t),r.prototype.apiEndpoint=function(){return"/flamarkt/orders"+(this.exists?"/"+this.data.id:"")},r}(f),g=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).number=f.attribute("number"),r.group=f.attribute("group"),r.type=f.attribute("type"),r.label=f.attribute("label"),r.comment=f.attribute("comment"),r.quantity=f.attribute("quantity"),r.priceUnit=f.attribute("priceUnit"),r.priceTotal=f.attribute("priceTotal"),r.product=f.hasOne("product"),r}return p(r,t),r}(f),b=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).title=f.attribute("title"),r.slug=f.attribute("slug"),r.description=f.attribute("description"),r.descriptionHtml=f.attribute("descriptionHtml"),r.price=f.attribute("price"),r.priceEdit=f.attribute("priceEdit"),r.cartQuantity=f.attribute("cartQuantity"),r.isHidden=f.attribute("isHidden"),r.canOrder=f.attribute("canOrder"),r.canEdit=f.attribute("canEdit"),r}p(r,t);var e=r.prototype;return e.cartPriceTotalLocal=function(){return this.price&&this.cartQuantity?this.price()*this.cartQuantity():0},e.apiEndpoint=function(){return"/flamarkt/products"+(this.exists?"/"+this.data.id:"")},r}(f);function w(){return(w=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}var k=e(1),x=e.n(k),P=e(13),I=e.n(P),T=e(4),S=e.n(T),C=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){var t=this,r=this.options(),e=this.activeSort();return m(I.a,{className:"SortDropdown "+this.className(),buttonClassName:"Button",label:r[e]},Object.keys(r).map((function(e){var n=r[e],o=e===t.activeSort();return m(S.a,{icon:!o||"fas fa-check",onclick:function(){t.applySort(e)},active:o},n)})))},e.className=function(){return""},e.activeSort=function(){return this.attrs.state.params.sort||this.defaultSort()},e.applySort=function(t){var r=w({},m.route.param());if(this.defaultSort()===t?(delete this.attrs.state.params.sort,delete r.sort):(this.attrs.state.params.sort=t,r.sort=t),this.attrs.updateUrl){delete r.key;var e=app.current.data.routeName;m.route.set(app.route(e,r))}else this.attrs.state.refresh()},e.defaultSort=function(){return Object.keys(this.options())[0]},r}(x.a),A=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.isActive=function(t){return m.route.get()===t.href||r.activeRoutes(t).some((function(t){var r=app.current.data.routeName;if(!r)return!1;var e=t.indexOf("*");return-1!==e?0===r.indexOf(t.substr(0,e)):r===t}))},r.activeRoutes=function(t){return t.activeRoutes?t.activeRoutes:[]},r}(c.a),N=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.decimals=function(){return this.attrs.decimals||0},e.min=function(){return this.attrs.min},e.max=function(){return this.attrs.max},e.step=function(){return this.attrs.step},e.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},e.toIntegerValue=function(t){return Math.round(t*Math.pow(10,this.decimals()))},e.view=function(){var t=this,r={type:"number",value:this.fromIntegerValue(this.attrs.value)+"",onchange:function(r){var e=parseFloat(r.target.value);t.attrs.onchange(t.toIntegerValue(e))}},e=this.min();void 0!==e&&(r.min=this.fromIntegerValue(e));var n=this.max();void 0!==n&&(r.max=this.fromIntegerValue(n));var o=this.step();return void 0!==o?r.step=this.fromIntegerValue(o):this.decimals()>0&&(r.step=1/Math.pow(10,this.decimals())),m("input.FormControl",r)},r}(x.a),L=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.decimals=function(){return this.attrs.decimals||0},e.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},e.view=function(){return this.fromIntegerValue(this.attrs.value).toFixed(this.decimals())},r}(x.a),O=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"OrderSortDropdown"},e.options=function(){return{"-createdAt":"Newest",createdAt:"Oldest","-priceTotal":"Highest total",priceTotal:"Lowest total"}},r}(C),F=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.decimals=function(){return app.forum.attribute("priceDecimals")},r}(N),D=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.decimals=function(){return app.forum.attribute("priceDecimals")},e.view=function(){return[t.prototype.view.call(this)," ",app.forum.attribute("priceUnit")]},r}(L),R=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"ProductSortDropdown"},e.options=function(){return{"-createdAt":"Newest",createdAt:"Oldest",price:"Cheapest","-price":"Most expensive",title:"Title ASC","-title":"Title DESC"}},r}(C),q=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r}(N),M=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r}(L),B=function(){function t(){this.sortingIndex=null,this.showPlaceholderForIndex=0,this.dragoverenterhandler=void 0,this.drophandler=void 0}var r=t.prototype;return r.oncreate=function(t){var r=this;this.dragoverenterhandler=function(e){if(null!==r.sortingIndex){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move";var n=0;t.dom.childNodes.forEach((function(r){var o=parseInt(r.dataset.index||"");if(!isNaN(o)){var a=r.getBoundingClientRect();if("horizontal"===t.attrs.direction){if(!a.width)return;var i=a.left+a.width/2;e.pageX>i+window.scrollX&&(n=o+1)}else{if(!a.height)return;var s=a.top+a.height/2;e.pageY>s+window.scrollY&&(n=o+1)}}})),n!==r.showPlaceholderForIndex&&(r.showPlaceholderForIndex=n,m.redraw())}},document.addEventListener("dragover",this.dragoverenterhandler),document.addEventListener("dragenter",this.dragoverenterhandler),this.drophandler=function(e){if(null!==r.sortingIndex){e.preventDefault(),e.stopPropagation();var n=r.sortingIndex,o=r.showPlaceholderForIndex-(r.showPlaceholderForIndex>r.sortingIndex?1:0);r.sortingIndex=null,m.redraw(),o!==n&&t.attrs.onsort(n,o)}},document.addEventListener("drop",this.drophandler)},r.onremove=function(){document.removeEventListener("dragover",this.dragoverenterhandler),document.removeEventListener("dragenter",this.dragoverenterhandler),document.removeEventListener("drop",this.drophandler)},r.view=function(t){var r=this,e=[];t.children.forEach((function(n,o){null!==r.sortingIndex&&r.showPlaceholderForIndex===o&&e.push(r.placeholder(t)),o===r.sortingIndex&&(n.attrs.style||(n.attrs.style={}),n.attrs.style.display="none"),n.attrs["data-index"]=o,n.attrs.ondragstart=function(e){if(e.target&&e.dataTransfer){var n=t.attrs.handleClassName;if(void 0===n&&(n="js-handle"),n&&!e.target.classList.contains(n)||t.attrs.disabled)e.redraw=!1;else{var a=Array.from(t.dom.childNodes).find((function(t){return t.dataset.index===o+""}));if(!a)return;var i=a.getBoundingClientRect();e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",o+""),e.dataTransfer.setDragImage(a,e.pageX-i.left-window.scrollX,e.pageY-i.top-window.scrollY),r.sortingIndex=o,r.showPlaceholderForIndex=o}}},e.push(n)})),null!==this.sortingIndex&&this.showPlaceholderForIndex===t.children.length&&e.push(this.placeholder(t));var n={};return t.attrs.className&&(n.className=t.attrs.className),m(t.attrs.containerTag||"div",n,e)},r.placeholder=function(t){return m(t.attrs.placeholderTag||"div",{className:"SortablePlaceholder",key:"placeholder"},"tr"===t.attrs.placeholderTag?m("td",{colspan:100}):null)},t}(),E=e(14),Q=e.n(E),U=function(){function t(){}return t.prototype.view=function(t){var r={className:(t.attrs.className?t.attrs.className+" ":"")+"js-handle"};return t.attrs.disabled?r.className+=" disabled":r.draggable="true",m(t.attrs.elementTag||"div",r,Q()("fas fa-grip-lines"))},t}(),H=function(t){return t===parseInt(t)&&(t=(t/Math.pow(10,app.forum.attribute("priceDecimals"))).toFixed(app.forum.attribute("priceDecimals"))),[t," "+app.forum.attribute("priceUnit")]},j=e(8),_=e.n(j),V=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.load()},e.load=function(){var t=this,r=app.preloadedApiDocument(),e=m.route.param("id");if("new"===e){var n=this.newRecord();n&&this.show(n)}else if(r instanceof h.a)this.show(r);else{var o=this.requestParams();app.store.find(this.findType(),e,o).then((function(r){t.show(r),m.redraw()}))}},e.newRecord=function(){return null},e.findType=function(){return""},e.requestParams=function(){return{}},e.show=function(t){},e.saveThroughNewRecord=function(t,r){var e=this.newRecord();return e?(t&&(e.pushData({id:t}),e.exists=!0),e.save(r)):Promise.reject()},r}(_.a),K=function(t,r,e){void 0===e&&(e={}),this.number=void 0,this.items=void 0,this.links=void 0,this.number=t,this.items=r,this.links=e||{}},z=function(){function t(t){void 0===t&&(t={}),this.params={},this.pages=[],this.loading=!0,this.moreResults=!1,this.params=t}var r=t.prototype;return r.type=function(){return""},r.limit=function(){return 20},r.requestParams=function(){var t={filter:this.params.filter||{}};return this.params.sort&&(t.sort=this.params.sort),this.params.include&&(t.include=this.params.include),this.params.q&&(t.filter.q=this.params.q),t},r.clear=function(){this.pages=[],m.redraw()},r.refresh=function(t){var r=this,e=(void 0===t?{}:t).deferClear,n=void 0!==e&&e;return this.loading=!0,n||this.clear(),this.loadResults(0).then((function(t){r.pages=[],r.parseResults(t,0)}),(function(){r.loading=!1,m.redraw()}))},r.loadResults=function(t){var r=app.preloadedApiDocument();if(r)return Promise.resolve(r);var e=this.requestParams();return e.page={offset:t},app.store.find(this.type(),e)},r.loadMore=function(){var t=this;this.loading=!0;var r=this.pages.length;this.loadResults(r*this.limit()).then((function(e){t.parseResults(e,r)}))},r.parseResults=function(t,r){return t.length&&this.pages.push(new K(r,t,t.payload.links)),this.moreResults=t.payload.links&&!!t.payload.links.next,this.loading=!1,m.redraw(),t},r.remove=function(t){this.pages.forEach((function(r){var e=r.items.indexOf(t);-1!==e&&r.items.splice(e,1)}))},r.add=function(t){this.pages.length||this.pages.push(new K(1,[])),this.pages[0].items.unshift(t)},t}(),G=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.type=function(){return"flamarkt/orders"},r}(z),X=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.type=function(){return"flamarkt/products"},r}(z),Y=function(){function t(){this.callbacks=new Map,this.whenCallback=function(t){return!0}}var r=t.prototype;return r.onUp=function(t){return this.callbacks.set(38,(function(r){r.preventDefault(),t(r)})),this},r.onDown=function(t){return this.callbacks.set(40,(function(r){r.preventDefault(),t(r)})),this},r.onSelect=function(t){var r=function(r){r.preventDefault(),t(r)};return this.callbacks.set(9,r),this.callbacks.set(13,r),this},r.onCancel=function(t){return this.callbacks.set(27,(function(r){r.stopPropagation(),r.preventDefault(),t(r)})),this},r.onRemove=function(t){return this.callbacks.set(8,(function(r){0===r.target.selectionStart&&0===r.target.selectionEnd&&(t(r),r.preventDefault())})),this},r.when=function(t){return this.whenCallback=t,this},r.bindTo=function(t){t.on("keydown",this.navigate.bind(this))},r.navigate=function(t){if(this.whenCallback(t)){var r=this.callbacks.get(t.which);r&&r(t)}},t}(),W={"components/AbstractSortDropdown":C,"components/ActiveLinkButton":A,"components/DecimalInput":N,"components/DecimalLabel":L,"components/OrderSortDropdown":O,"components/PriceInput":F,"components/PriceLabel":D,"components/ProductSortDropdown":R,"components/QuantityInput":q,"components/QuantityLabel":M,"components/Sortable":B,"components/SortableHandle":U,"helpers/formatPrice":H,"models/Cart":v,"models/Order":y,"models/OrderLine":g,"models/Product":b,"pages/AbstractShowPage":V,"states/AbstractListState":z,"states/OrderListState":G,"states/ProductListState":X,"utils/KeyboardNavigatable":Y},J=e(10),Z=e.n(J),tt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("ul.Breadcrumb",Z()(this.items().toArray()))},e.items=function(){return this.attrs.items},r}(x.a),rt=e(0),et=e.n(rt),nt=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).attrs=void 0,r}p(r,t);var e=r.prototype;return e.view=function(){return m(".CartDropdownList",this.items().toArray())},e.items=function(){var t=new et.a;return t.add("products",m("p",app.translator.trans("flamarkt-core.forum.cartDropdown.products",{count:this.attrs.state.productCount()||0})),10),t.add("link",c.a.component({className:"Button Button--primary Button--block",href:app.route("flamarkt.cart")},app.translator.trans("flamarkt-core.forum.cartDropdown.action")),-10),t},r}(x.a),ot=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).attrs=void 0,r}p(r,t),r.initAttrs=function(r){r.className=r.className||"CartDropdown",r.buttonClassName=r.buttonClassName||"Button Button--flat",r.menuClassName=r.menuClassName||"Dropdown-menu--right",r.label=r.label||o.a.translator.trans("flamarkt-core.forum.cartDropdown.label"),t.initAttrs.call(this,r)};var e=r.prototype;return e.getButton=function(t){return m("a.Dropdown-toggle",{className:this.attrs.buttonClassName,"data-toggle":"dropdown",onclick:this.onclick.bind(this),title:this.attrs.label,href:o.a.route("flamarkt.cart")},this.getButtonContent(t))},e.getButtonContent=function(t){var r="fas fa-shopping-cart";return this.attrs.state.loading&&(r="fas fa-spinner fa-pulse"),[Q()(r,{className:"Button-icon"}),m("span.Button-label",m(D,{value:this.attrs.state.priceTotal()||0,hint:"cart dropdown"}))]},e.getMenu=function(){return m(".Dropdown-menu",{className:this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?nt.component({state:this.attrs.state}):null)},e.onclick=function(t){t.preventDefault(),o.a.drawer.isOpen()?this.goToRoute():this.showing||this.attrs.state.load()},e.goToRoute=function(){m.route.set(o.a.route("flamarkt.cart"))},e.menuClick=function(t){(t.shiftKey||t.metaKey||t.ctrlKey||2===t.which)&&t.stopPropagation()},r}(I.a),at=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.view=function(t){return m("section",{className:"CartPage-section "+t.attrs.className},[m("h3",t.attrs.title),t.children])},r}(x.a),it=e(9),st=e.n(it),ut=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("tr",this.columns().toArray())},e.columns=function(){var t=new et.a,r=this.attrs.product;return t.add("product",m("td",m(st.a,{href:app.route.product(r)},r.title()))),t.add("quantity",m("td",m(q,{value:this.attrs.product.cartQuantity(),onchange:function(t){},product:r}))),t.add("total",m("td",m(D,{value:r.cartPriceTotalLocal(),hint:"cart product total",product:r}))),t.add("delete",m("td",S.a.component({className:"Button Button--icon",icon:"fas fa-times"}))),t},r}(x.a),ct=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("table.CartTable",[m("thead",m("tr",this.head().toArray())),m("tbody",this.rows().toArray())])},e.head=function(){var t=new et.a;return t.add("product",m("th","Product")),t.add("quantity",m("th","Quantity")),t.add("total",m("th","Total")),t.add("actions",m("th")),t},e.rows=function(){var t=new et.a,r=this.attrs.cart.products()||[];return r.forEach((function(r){t.add("product-"+r.id(),ut.component({product:r}))})),0===r.length?t.add("empty",m("tr",m("td",{colspan:100},"Cart is empty"))):t.add("total",m("tr",[m("th",{colspan:2},"Total"),m("th",m(D,{value:this.attrs.cart.priceTotalLocal(),hint:"cart total"}))])),t},r}(x.a),lt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("tr",this.columns().toArray())},e.columns=function(){var t=new et.a,r=this.attrs.line,e=r.product();return t.add("number",m("td",r.number()),100),t.add("product",m("td",this.productContent()),30),t.add("priceUnit",m("td",m(D,{value:r.priceUnit(),product:e,hint:"order line unit"})),-30),t.add("quantity",m("td",m(M,{value:r.quantity(),product:e})),-60),t.add("priceTotal",m("td",m(D,{value:r.priceTotal(),hint:"order line total",product:e})),-90),t},e.productContent=function(){return[this.labelContent(),this.commentContent()]},e.labelContent=function(){var t=this.attrs.line,r=t.product();return"product"===t.type()&&r?m(st.a,{href:app.route.product(r)},r.title()):t.label()||m("em","N/A")},e.commentContent=function(){var t=this.attrs.line;return t.comment()?m(".comment",t.comment()):null},r}(x.a),pt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return this.visible()?m("tr",this.columns().toArray()):null},e.visible=function(){return!1},e.columns=function(){var t=new et.a;return t.add("number",m("th"),100),t.add("product",m("th"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th"),-90),t},r}(x.a),dt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return this.visible()?m("tr",this.columns().toArray()):null},e.visible=function(){return null===this.attrs.group},e.subtotal=function(){return this.attrs.lines.reduce((function(t,r){return t+(r.priceTotal()||0)}),0)},e.columns=function(){var t=new et.a;return t.add("number",m("th"),100),t.add("product",m("th","Subtotal"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th",m(D,{value:this.subtotal(),hint:"order group subtotal"})),-90),t},r}(x.a),mt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("table.CartTable",[m("thead",m("tr",this.head().toArray())),m("tbody",this.rows().toArray()),m("tfoot",m("tr",this.foot().toArray()))])},e.head=function(){var t=new et.a;return t.add("number",m("th"),100),t.add("product",m("th","Product"),30),t.add("priceUnit",m("th","Price"),-30),t.add("quantity",m("th","Quantity"),-60),t.add("priceTotal",m("th","Total"),-90),t},e.foot=function(){var t=new et.a;return t.add("number",m("th"),100),t.add("product",m("th","Total"),30),t.add("priceUnit",m("th"),-30),t.add("quantity",m("th"),-60),t.add("priceTotal",m("th",m(D,{value:this.attrs.order.priceTotal(),hint:"order foot total"})),-90),t},e.rows=function(){var t=new et.a,r=!0,e="__not_exists",n=[];return(this.attrs.order.lines()||[]).forEach((function(o){o.group()!==e&&(r||t.add("group-foot-"+e,m(dt,{group:e,lines:n})),e=o.group(),n=[],t.add("group-head-"+e,m(pt,{group:e,line:[]}))),t.add("line-"+o.id(),lt.component({line:o})),n.push(o),r=!1})),r||t.add("group-foot-"+e,m(dt,{group:e,lines:n})),t},r}(x.a),ht=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m("li.ProductListItem",this.link(this.items().toArray()))},e.link=function(t){return m(st.a,{className:"ProductListItem--link",href:app.route.product(this.attrs.product)},t)},e.items=function(){var t=new et.a,r=this.attrs.product;return t.add("price",m("span.ProductListItem--price",H(r.price())),20),t.add("title",m("span.ProductListItem--title",r.title()),10),t},r}(x.a),ft=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).cartQuantity=1,r.savingQuantity=!1,r}p(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.cartQuantity=this.attrs.product.cartQuantity()||1},e.view=function(){var t=this,r=this.attrs.product;return m(".ProductQuantity",[m(q,{value:this.cartQuantity,onchange:function(r){t.cartQuantity=r},product:r,min:0}),S.a.component({className:"Button Button--primary Button--block",disabled:this.cartQuantity===r.cartQuantity(),loading:this.savingQuantity,onclick:function(){t.savingQuantity=!0,r.save({cartQuantity:t.cartQuantity}).then((function(){t.savingQuantity=!1,t.cartQuantity=r.cartQuantity()||1,m.redraw(),app.cart.load()})).catch((function(r){throw t.savingQuantity=!1,m.redraw(),r}))}},app.translator.trans(r.cartQuantity()?"flamarkt-core.forum.product.updateCartQuantity":"flamarkt-core.forum.product.addToCart")),r.cartQuantity()?S.a.component({className:"Button Button--block",loading:this.savingQuantity,onclick:function(){t.savingQuantity=!0,r.save({cartQuantity:0}).then((function(){t.savingQuantity=!1,t.cartQuantity=1,m.redraw(),app.cart.load()})).catch((function(r){throw t.savingQuantity=!1,m.redraw(),r}))}},app.translator.trans("flamarkt-core.forum.product.removeFromCart")):null])},r}(x.a),vt=e(12),yt=e.n(vt),gt=function(){function t(){this.results=new Map}var r=t.prototype;return r.search=function(t){var r=this;return app.store.find("flamarkt/products",{filter:{q:t},page:{limit:5}}).then((function(e){r.results.set(t,e),m.redraw()}))},r.view=function(t){var r=this;t=t.toLowerCase();var e=(this.results.get(t)||[]).map((function(e){return m("li.UserSearchResult",{"data-index":"products"+e.id()},m(st.a,{href:app.route.product(e)},r.product(e,t).toArray()))}));return[m("li.Dropdown-header",app.translator.trans("flamarkt-core.forum.search.products.heading")),m("li",c.a.component({icon:"fas fa-search",href:app.route("flamarkt.products.index",{q:t})},app.translator.trans("flamarkt-core.forum.search.products.all",{query:t})))].concat(e)},r.product=function(t,r){var e=new et.a;return e.add("title",yt()(t.title(),r)),e},t}(),bt=e(11),wt=e.n(bt),kt=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).attrs=void 0,r}p(r,t);var e=r.prototype;return e.view=function(t){var r=this.className();return m(".ShopPage",{className:r||void 0},[wt.a.prototype.hero(),m(".container",m(".sideNavContainer",[m("nav.IndexPage-nav.ShopPage-nav.sideNav",m("ul",Z()(this.sidebarItems().toArray()))),m(".ShopPage-content.sideNavOffset",[tt.component({items:this.breadcrumbItems()}),this.contentTitle(),this.content(t)])]))])},e.sidebarItems=function(){return wt.a.prototype.sidebarItems()},e.breadcrumbItems=function(){var t=new et.a;"/"!==this.currentPageHref()&&t.add("home",c.a.component({href:"/"},"Home"),100);var r=this.title();return r&&t.add("current",m("span.breadcrumb-current",r),-100),t},e.className=function(){return""},e.title=function(){return""},e.currentPageHref=function(){return null},e.contentTitle=function(){var t=this.title();return t?m("h1",t):null},r}(x.a),xt=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return this.currentPageHref()!==app.route("flamarkt.account")&&r.add("account",c.a.component({href:app.route("flamarkt.account")},"Account")),r},r}(kt),Pt={controls:function(t){var r=new et.a;return r.add("orders",c.a.component({href:app.route("flamarkt.account.orders")},"Orders"),10),r.add("settings",c.a.component({href:app.route("settings")},"Settings"),-10),r}},It=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"AccountPage"},e.title=function(){return app.translator.trans("flamarkt-core.forum.account.headingTitle")},e.currentPageHref=function(){return app.route("flamarkt.account")},e.content=function(){return m("ul",Z()(Pt.controls(app.session.user).toArray()))},r}(xt),Tt=e(7),St=e.n(Tt),Ct=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).submitting=!1,r}p(r,t);var e=r.prototype;return e.className=function(){return"CartPage"},e.title=function(){return app.translator.trans("flamarkt-core.forum.cart.headingTitle")},e.content=function(){var t=this.attrs.cart;return t?t.exists?m("form",{onsubmit:this.onsubmit.bind(this)},this.sections().toArray()):"No cart":St.a.component()},e.sectionProducts=function(){var t=new et.a;return t.add("table",ct.component({cart:this.attrs.cart})),t},e.sectionPayment=function(){return new et.a},e.sections=function(){var t=new et.a;t.add("products",at.component({className:"CartPage-products",title:"Products"},this.sectionProducts().toArray()));var r=this.sectionPayment().toArray();return r.length&&t.add("payment",at.component({className:"CartPage-payment",title:"Payment"},r)),t.add("submit",m(".Form-group",S.a.component({type:"submit",className:"Button Button--primary",loading:this.submitting},"Place order"))),t},e.data=function(){return{relationships:{cart:this.attrs.cart}}},e.onsubmit=function(t){var r=this;t.preventDefault(),this.submitting=!0,app.store.createRecord("flamarkt-orders").save(this.data()).then((function(t){m.route.set(app.route.order(t))})).catch((function(t){throw r.submitting=!1,m.redraw(),t}))},r}(kt),At=e(19),Nt=e.n(At),Lt=e(15),Ot=e.n(Lt),Ft=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"OrderIndexPage"},e.title=function(){return app.translator.trans("flamarkt-core.forum.orders.headingTitle")},e.content=function(){var t=this;return m("div",[m(".Form-group",[m(O,{state:this.attrs.state})]),m("table.CartTable",[m("thead",m("tr",this.headerRow().toArray())),m("tbody",[this.attrs.state.pages.map((function(r){return r.items.map((function(r){return m("tr",t.orderRow(r).toArray())}))})),this.bottomRow()])])])},e.headerRow=function(){var t=new et.a;return t.add("number",m("th","#"),40),t.add("createdAt",m("th","Date"),30),t.add("productCount",m("th","Products"),20),t.add("priceTotal",m("th","Total"),10),t},e.orderRow=function(t){var r=new et.a;return r.add("number",m("td",m(st.a,{href:app.route.order(t)},t.number())),40),r.add("createdAt",m("td",Nt()(t.createdAt())),30),r.add("productCount",m("td",t.productCount()),20),r.add("priceTotal",m("td",m(D,{value:t.priceTotal()})),10),r},e.bottomRowContent=function(){return this.attrs.state.loading?St.a.component():this.attrs.state.moreResults?S.a.component({className:"Button Button--block",onclick:this.attrs.state.loadMore.bind(this.attrs.state)},"Load more"):0!==this.attrs.state.pages.length||this.attrs.state.loading?void 0:Ot.a.component({text:"No orders yet"})},e.bottomRow=function(){var t=this.bottomRowContent();return t?m("tr",m("td",{colspan:100},t)):null},r}(xt),Dt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"OrderShowPage"},e.title=function(){return this.attrs.order?app.translator.trans("flamarkt-core.forum.order.headingTitle",{number:this.attrs.order.number()}):"Order"},e.content=function(){return this.attrs.order?this.sections().toArray():St.a.component()},e.sections=function(){var t=new et.a;return t.add("table",mt.component({order:this.attrs.order}),10),t},r}(xt),Rt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.className=function(){return"ProductIndexPage"},e.title=function(){return"/"===this.currentPageHref()?"Home":app.translator.trans("flamarkt-core.forum.products.headingTitle")},e.currentPageHref=function(){return app.route("flamarkt.products.index")},e.contentTitle=function(){return"/"===this.currentPageHref()?null:t.prototype.contentTitle.call(this)},e.content=function(){return[m(".ProductListFilters",this.filters().toArray()),m("ul.ProductList",this.attrs.state.pages.map((function(t){return t.items.map((function(t){return ht.component({product:t})}))}))),this.bottomControls()]},e.bottomControls=function(){return this.attrs.state.loading?St.a.component():this.attrs.state.moreResults?S.a.component({className:"Button",onclick:this.attrs.state.loadMore.bind(this.attrs.state)},"Load more"):0!==this.attrs.state.pages.length||this.attrs.state.loading?void 0:Ot.a.component({text:"No results"})},e.filters=function(){var t=new et.a;return t.add("sort",m(R,{state:this.attrs.state,updateUrl:!0})),t},r}(kt),qt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return r.add("products",c.a.component({href:app.route("flamarkt.products.index")},app.translator.trans("flamarkt-core.forum.breadcrumb.products"))),r},e.className=function(){return"ProductShowPage"},e.product=function(){return this.attrs.product},e.title=function(){var t=this.product();return t?t.title():""},e.contentTitle=function(){return null},e.content=function(){var t=this.product();return t?this.loadedContent(t):this.loadingContent()},e.loadingContent=function(){return St.a.component({className:"LoadingIndicator--block"})},e.loadedContent=function(t){return m(".ProductShowSections",m.fragment({key:t.id()},this.sections(t).toArray()))},e.sections=function(t){var r=new et.a,e=this.gallerySection(t).toArray();return e.length&&r.add("gallery",m("section.ProductShowSection.ProductShowSection--gallery",e),30),r.add("price",m("section.ProductShowSection.ProductShowSection--price",this.priceSection(t).toArray()),20),r.add("description",m("section.ProductShowSection.ProductShowSection--description",this.descriptionSection(t).toArray()),10),r},e.gallerySection=function(t){return new et.a},e.priceSection=function(t){var r=new et.a;return t.canEdit()&&r.add("edit",c.a.component({className:"Button",href:app.forum.attribute("backofficeUrl")+"/products/"+t.id(),external:!0},"Edit"),200),r.add("title",m("h1",t.title()),100),r.add("price",m("p",m(D,{value:t.price(),hint:"product"})),50),this.showCartControls(t)&&r.add("quantity",ft.component({product:t}),20),r},e.showCartControls=function(t){return!!t.canOrder()},e.descriptionSection=function(t){var r=new et.a,e=t.descriptionHtml();return e&&r.add("description",m("div",m.trust(e)),10),r},r}(kt),Mt=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.view=function(){return m(".ShopPage",[wt.a.prototype.hero(),m(".container",m(".sideNavContainer",[m("nav.ShopPage-nav.sideNav",m("ul",Z()(this.sidebarItems().toArray()))),m(".ShopPage-content.sideNavOffset",[tt.component({items:this.breadcrumbItems()}),this.content()])]))])},e.sidebarItems=function(){return wt.a.prototype.sidebarItems()},e.breadcrumbItems=function(){var t=new et.a;return t.add("home",c.a.component({href:app.route("index")},"Home"),100),t},r}(_.a),Bt=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return r.add("account",c.a.component({href:app.route("flamarkt.account")},"Account")),r},r}(Mt),Et=function(t){function r(){return t.apply(this,arguments)||this}p(r,t);var e=r.prototype;return e.oncreate=function(r){t.prototype.oncreate.call(this,r),app.setTitle(app.translator.trans("flamarkt-core.forum.account.browserTitle")),app.setTitleCount(0)},e.view=function(){return It.component()},r}(_.a),Qt=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).loading=!0,r.cart=null,r}p(r,t);var e=r.prototype;return e.oninit=function(r){var e=this;t.prototype.oninit.call(this,r),app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/flamarkt/cart"}).then((function(t){e.loading=!1,e.cart=app.store.pushPayload(t),m.redraw()})).catch((function(t){throw e.loading=!1,m.redraw(),t})),app.setTitle(app.translator.trans("flamarkt-core.forum.cart.browserTitle")),app.setTitleCount(0)},e.view=function(){var t;return t=this.loading?null:this.cart?this.cart:app.store.createRecord("flamarkt-carts"),Ct.component({cart:t})},r}(_.a),Ut=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).state=void 0,r}p(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.state=this.initState(),this.state.refresh(),app.setTitle(app.translator.trans("flamarkt-core.forum.orders.browserTitle")),app.setTitleCount(0)},e.initState=function(){return new G({filter:{user:app.session.user?app.session.user.id():0}})},e.view=function(){return Ft.component({state:this.state})},r}(_.a),Ht=e(16),jt=e.n(Ht),_t=e(20),Vt=e.n(_t),Kt=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).searchFilter="",r.debouncedSearchFilter="",r.searchDebouncer=void 0,r.activeListIndex=0,r.inputIsFocused=!1,r.navigator=void 0,r.dropdownIsFocused=!1,r.onmousedown=void 0,r}p(r,t);var e=r.prototype;return e.className=function(){return""},e.normalizedValue=function(){return Array.isArray(this.attrs.relationship)?this.attrs.relationship:this.attrs.relationship?[this.attrs.relationship]:[]},e.setValue=function(t){this.attrs.hasOne?this.attrs.onchange(t.length?t[0]:null):this.attrs.onchange(t)},e.oninit=function(r){var e=this;t.prototype.oninit.call(this,r),this.navigator=new Y,this.navigator.onUp((function(){return e.setIndex(e.activeListIndex-1,!0)})).onDown((function(){return e.setIndex(e.activeListIndex+1,!0)})).onSelect(this.select.bind(this)).onRemove((function(){var t=e.normalizedValue();t.length&&e.toggleModel(t[t.length-1])})).when((function(t){return" "===t.key&&""===e.searchFilter?(t.preventDefault(),e.select(t),!1):"Tab"!==t.key}))},e.oncreate=function(r){var e=this;t.prototype.oncreate.call(this,r),this.element=r.dom,this.onmousedown=function(t){var n=r.dom.querySelector(".Dropdown-menu");n&&n.contains(t.target)?e.dropdownIsFocused||(e.dropdownIsFocused=!0,m.redraw()):e.dropdownIsFocused&&(e.dropdownIsFocused=!1,m.redraw())},document.addEventListener("mousedown",this.onmousedown)},e.onremove=function(r){t.prototype.onremove.call(this,r),document.removeEventListener("mousedown",this.onmousedown)},e.indexInSelectedModels=function(t){return this.normalizedValue().findIndex((function(r){return r.id()===t.id()}))},e.addModel=function(t){if(this.attrs.hasOne)this.setValue([t]);else{var r=this.normalizedValue();r.push(t),this.setValue(r)}},e.removeModel=function(t){var r=this.indexInSelectedModels(t);if(-1!==r){var e=this.normalizedValue();e.splice(r,1),this.setValue(e)}},e.view=function(){return m(".RelationshipSelect",{className:this.className()},[m(".RelationshipSelect-Form",this.formItems().toArray()),this.listAvailableModels(this.results(this.debouncedSearchFilter))])},e.formItems=function(){var t=new et.a;return t.add("input",m(".RelationshipSelect-FakeInput-Wrapper",m(".RelationshipSelect-FakeInput.FormControl",{className:this.inputIsFocused?"focus":""},this.inputItems().toArray())),20),t},e.inputItems=function(){var t=this,r=new et.a;return r.add("selected",this.normalizedValue().map((function(r){return m("span.RelationshipSelect-Selected",{onclick:function(){t.toggleModel(r),t.onready()}},t.item(r))})),20),r.add("control",m("input.FormControl",{placeholder:this.attrs.placeholder,value:this.searchFilter,oninput:function(r){t.searchFilter=r.target.value,t.activeListIndex=0,clearTimeout(t.searchDebouncer),t.searchDebouncer=setTimeout((function(){t.debouncedSearchFilter=t.searchFilter,t.search(t.debouncedSearchFilter)}),300)},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:this.oninputfocus.bind(this),onblur:this.oninputblur.bind(this)}),10),r},e.oninputfocus=function(){this.inputIsFocused=!0,""===this.debouncedSearchFilter&&this.search(this.debouncedSearchFilter)},e.oninputblur=function(){this.inputIsFocused=!1},e.listAvailableModels=function(t){return!this.inputIsFocused&&!this.dropdownIsFocused||Array.isArray(t)&&0===t.length?null:(r=null===t?St.a.component():t.map(this.listAvailableModel.bind(this)),m("ul.Dropdown-menu.RelationshipSelect-Dropdown",r));var r},e.listAvailableModel=function(t,r){var e=this;return m("li.RelationshipSelect-Dropdown-Item",{"data-index":r,className:Vt()({selected:-1!==this.indexInSelectedModels(t),active:this.activeListIndex===r}),onmouseover:function(){return e.activeListIndex=r},onclick:this.toggleModel.bind(this,t)},m(".RelationshipSelect-Dropdown-Item-Wrap",this.item(t,this.debouncedSearchFilter)))},e.toggleModel=function(t){var r=this;-1!==this.indexInSelectedModels(t)?this.removeModel(t):this.addModel(t),this.searchFilter&&(this.searchFilter="",this.debouncedSearchFilter="",this.activeListIndex=0),setTimeout((function(){r.onready()}))},e.select=function(t){var r=this.getDomElement(this.activeListIndex);if(!r.length)return this.searchFilter="",void(this.debouncedSearchFilter="");r[0].dispatchEvent(new Event("click"))},e.getDomElement=function(t){return this.$('.RelationshipSelect-Dropdown-Item[data-index="'+t+'"]')},e.setIndex=function(t,r){var e=this.$(".RelationshipSelect-Dropdown"),n=this.$(".RelationshipSelect-Dropdown-Item").length;t<0?t=n-1:t>=n&&(t=0);var o=this.getDomElement(t);if(this.activeListIndex=t,m.redraw(),r){var a,i,s,u=e.scrollTop()||0,c=(null==(a=e.offset())?void 0:a.top)||0,l=c+(e.outerHeight()||0),p=(null==(i=o.offset())?void 0:i.top)||0,d=p+(o.outerHeight()||0);p<c?s=u-c+p-parseInt(e.css("padding-top"),10):d>l&&(s=u-l+d+parseInt(e.css("padding-bottom"),10)),void 0!==s&&e.stop(!0).animate({scrollTop:s},100)}},e.onready=function(){this.$("input").first().focus().select()},r}(x.a),zt=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).resultsCache=new Map,r}p(r,t);var e=r.prototype;return e.search=function(t){var r=this;return t?app.store.find("flamarkt/products",{filter:{q:t},page:{limit:5}}).then((function(e){r.resultsCache.set(t,e),m.redraw()})):(m.redraw(),Promise.resolve())},e.results=function(t){if(!t)return[];t=t.toLowerCase();var r=this.resultsCache.get(t);return void 0===r?null:(r||[]).concat(app.store.all("flamarkt-products").filter((function(r){return r.title().toLowerCase().substr(0,t.length)===t}))).filter((function(t,r,e){return e.lastIndexOf(t)===r})).sort((function(t,r){return t.title().localeCompare(r.title())}))},e.item=function(t,r){return[r?yt()(t.title(),r):t.title()]},r}(Kt),Gt=function(){function t(){}var r=t.prototype;return r.view=function(t){var r=t.attrs,e=r.line,n=r.control,o=r.onchange,a=r.sortable,i=r.style,s=r.ondragstart;return m("tr",{style:i,"data-index":t.attrs["data-index"],ondragstart:s},this.columns(e,n,o,a).toArray())},r.columns=function(t,r,e,n){var o=new et.a;return o.add("handle",m("td.OrderLineEdit-Handle",n?m(U):null),100),o.add("group",m("td.OrderLineEdit-Group",jt.a.component({value:null===t.group?"_none":t.group,onchange:function(r){t.group="_none"===r?null:r,e()},options:{_none:"None",shipping:"Shipping"}})),90),o.add("type",m("td.OrderLineEdit-Type",jt.a.component({value:t.type,onchange:function(r){t.type=r,e()},options:{product:"Product",manual:"Manual"}})),80),o.add("info",m("td.OrderLineEdit-Info",this.fields(t,e).toArray()),30),o.add("priceUnit",m("td.OrderLineEdit-PriceUnit",m(F,{value:t.priceUnit,onchange:function(r){t.priceUnit=r,t.updateTotal(),e()},product:t.product})),-30),o.add("quantity",m("td.OrderLineEdit-Quantity",m(q,{value:t.quantity,onchange:function(r){t.quantity=r,t.updateTotal(),e()},product:t.product})),-60),o.add("priceTotal",m("td.OrderLineEdit-PriceTotal",m(D,{value:t.priceTotal,product:t.product})),-90),o.add("control",m("td.OrderLineEdit-Controls",r),-100),o},r.showInfoProduct=function(t){return"product"===t.type},r.showInfoLabel=function(t){return"manual"===t.type},r.showInfoComment=function(t){return"product"===t.type||"manual"===t.type},r.fields=function(t,r){var e=new et.a;return this.showInfoProduct(t)&&e.add("product",m(".Form-group",[m("label","Product"),m(zt,{relationship:t.product,onchange:function(e){t.product=e,r()},hasOne:!0})])),this.showInfoLabel(t)&&e.add("label",m(".Form-group",[m("label","Label"),m("input.FormControl",{type:"text",value:t.label,onchange:function(e){t.label=e.target.value,r()}})])),this.showInfoComment(t)&&e.add("comment",m(".Form-group",[m("label","Comment"),m("textarea.FormControl",{value:t.comment,onchange:function(e){t.comment=e.target.value,r()}})])),e},t}();var $t=["exists","dirty"],Xt=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.view=function(t){var r=t.attrs,e=r.exists,n=void 0!==e&&e,o=r.dirty,a=void 0===o||o,i=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(r,$t),s="";return s=(Array.isArray(t.children)?t.children.some((function(t){return t})):t.children)?t.children:n?a?"Save":"Saved":"Create",S.a.component(w({type:"submit",className:"Button Button--primary",disabled:n&&!a},i),s)},r}(x.a),Yt=e(21),Wt=e.n(Yt),Jt=e(22),Zt=e.n(Jt),tr=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).resultsCache=new Map,r}p(r,t);var e=r.prototype;return e.className=function(){return"UserRelationshipSelect"},e.search=function(t){var r=this;return t?app.store.find("users",{filter:{q:t},page:{limit:5}}).then((function(e){r.resultsCache.set(t,e),m.redraw()})):(m.redraw(),Promise.resolve())},e.results=function(t){if(!t)return[];t=t.toLowerCase();var r=this.resultsCache.get(t);return void 0===r?null:(r||[]).concat(app.store.all("users").filter((function(r){return[r.username(),r.displayName()].some((function(r){return r.toLowerCase().substr(0,t.length)===t}))}))).filter((function(t,r,e){return e.lastIndexOf(t)===r})).sort((function(t,r){return t.displayName().localeCompare(r.displayName())}))},e.item=function(t,r){var e=Wt()(t);return[Zt()(t),r?w({},e,{text:void 0,children:[yt()(e.text,r)]}):e]},r}(Kt),rr=0,er=function(){function t(){this.uniqueFormKey=void 0,this.line=void 0,this.group=null,this.type=null,this.label="",this.comment="",this.quantity=0,this.priceUnit=0,this.priceTotal=0,this.product=null,this.uniqueFormKey=++rr+""}var r=t.prototype;return r.init=function(t){this.line=t,this.group=t.group()||null,this.type=t.type()||null,this.label=t.label()||"",this.comment=t.comment()||"",this.quantity=t.quantity()||0,this.priceUnit=t.priceUnit()||0,this.priceTotal=t.priceTotal()||0,this.product=t.product()||null},r.updateTotal=function(){this.priceTotal=this.quantity*this.priceUnit},r.data=function(){var t={attributes:{group:this.group,type:this.type,label:this.label,comment:this.comment,quantity:this.quantity,priceUnit:this.priceUnit},relationships:{product:{data:h.a.getIdentifier(this.product)}}};return this.line&&(t.id=this.line.id()),t},t}(),nr=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).saving=!1,r}return p(r,t),r.prototype.view=function(){var t=this,r=this.attrs.model;return r.exists?m(S.a,{className:"Button",icon:r.isHidden()?"fas fa-eye":"fas fa-eye-slash",onclick:function(){t.saving=!0,r.save({isHidden:!r.isHidden()}).then((function(){t.saving=!1,m.redraw()})).catch((function(r){throw t.saving=!1,m.redraw(),r}))}},r.isHidden()?"Restore":"Soft Delete"):null},r}(x.a),or=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).saving=!1,r}return p(r,t),r.prototype.view=function(){var t=this,r=this.attrs.model;return r.isHidden()?m(S.a,{className:"Button",icon:"fas fa-trash",onclick:function(){confirm("Are you sure you want to permanently delete this record?")&&(t.saving=!0,r.delete().then((function(){t.saving=!1,m.redraw(),t.attrs.afterdelete()})).catch((function(r){throw t.saving=!1,m.redraw(),r})))}},"Delete Permanently"):null},r}(x.a),ar=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).order=null,r.user=null,r.lines=[],r.saving=!1,r.dirty=!1,r.newLine=void 0,r}p(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.initNewLine()},e.initNewLine=function(){this.newLine=new er},e.initLineState=function(t){var r=new er;return r.init(t),r},e.newRecord=function(){return app.store.createRecord("flamarkt-orders")},e.findType=function(){return"flamarkt/orders"},e.show=function(t){this.order=t,this.user=t.user()||null,this.lines=(t.lines()||[]).map(this.initLineState),app.setTitleCount(0)},e.view=function(){return this.order?m("form.OrderShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container.container--narrow",this.fields().toArray())):St.a.component()},e.fields=function(){var t=this,r=new et.a;return r.add("number",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.orders.field.number")),m("input.FormControl",{value:this.order.number(),readonly:!0})]),30),r.add("user",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.orders.field.user")),m(tr,{relationship:this.user,onchange:function(r){t.user=r,t.dirty=!0},hasOne:!0})]),20),r.add("lines",m("table.OrderComposerTable",[m("thead",m("tr",this.tableHead().toArray())),m(B,{containerTag:"tbody",placeholderTag:"tr",onsort:function(r,e){var n;(n=t.lines).splice.apply(n,[e,0].concat(t.lines.splice(r,1))),t.dirty=!0}},this.lines.map((function(r,e){return m(Gt,{key:r.uniqueFormKey,line:r,sortable:!0,control:S.a.component({icon:"fas fa-times",className:"Button Button--icon Button--delete",onclick:function(){t.lines.splice(e,1),t.dirty=!0},title:app.translator.trans("flamarkt-core.backoffice.orders.lines.control.delete")}),onchange:function(){t.dirty=!0}})}))),m("tbody",m(Gt,{key:"new",line:this.newLine,control:S.a.component({icon:"fas fa-plus",className:"Button Button--icon",onclick:function(){t.lines.push(t.newLine),t.dirty=!0,t.initNewLine()},title:app.translator.trans("flamarkt-core.backoffice.orders.lines.control.add")}),onchange:function(){t.dirty=!0}}))]),10),r.add("submit",m(".Form-group",[Xt.component({loading:this.saving,dirty:this.dirty,exists:this.order.exists})," ",nr.component({model:this.order})," ",or.component({model:this.order,afterdelete:function(){m.route.set(app.route("orders.index"))}})]),-10),r},e.tableHead=function(){var t=new et.a;return t.add("handle",m("th"),100),t.add("group",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.group")),90),t.add("type",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.type")),80),t.add("info",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.info")),30),t.add("priceUnit",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.priceUnit")),-30),t.add("quantity",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.quantity")),-60),t.add("priceTotal",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.priceTotal")),-90),t.add("control",m("th"),-100),t},e.data=function(){return{relationships:{lines:this.lines.map((function(t){return w({verbatim:!0,type:"flamarkt-product-lines"},t.data())})),user:this.user}}},e.onsubmit=function(t){var r,e=this;t.preventDefault(),this.saving=!0,this.saveThroughNewRecord(null==(r=this.order)?void 0:r.id(),this.data()).then((function(t){e.order=t,e.saving=!1,e.dirty=!1,m.redraw(),m.route.set(app.route.order(t))})).catch((function(t){e.saving=!1,m.redraw()}))},r}(V),ir=function(t){function r(){return t.apply(this,arguments)||this}return p(r,t),r.prototype.limit=function(){return 24},r}(X),sr=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).state=void 0,r}p(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.state=this.initState(),this.state.refresh(),app.setTitle(app.translator.trans("flamarkt-core.forum.products.browserTitle")),app.setTitleCount(0)},e.initState=function(){var t=m.route.param();return new ir({sort:t.sort})},e.view=function(){return Rt.component({state:this.state})},r}(_.a),ur=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).product=null,r}p(r,t);var e=r.prototype;return e.oninit=function(r){this.bodyClass="App--product",t.prototype.oninit.call(this,r)},e.findType=function(){return"flamarkt/products"},e.requestParams=function(){var r=t.prototype.requestParams.call(this);return r.bySlug=!0,r},e.show=function(t){this.product=t,app.setTitle(t.title()),app.setTitleCount(0)},e.view=function(){return qt.component({product:this.product})},r}(V),cr={"components/Breadcrumb":tt,"components/CartDropdown":ot,"components/CartPageSection":at,"components/CartTable":ct,"components/CartTableRow":ut,"components/OrderTable":mt,"components/OrderTableGroupFoot":dt,"components/OrderTableGroupHead":pt,"components/OrderTableRow":lt,"components/ProductListItem":ht,"components/ProductQuantity":ft,"components/ProductSearchSource":gt,"layouts/AbstractAccountLayout":xt,"layouts/AbstractShopLayout":kt,"layouts/AccountLayout":It,"layouts/CartLayout":Ct,"layouts/OrderIndexLayout":Ft,"layouts/OrderShowLayout":Dt,"layouts/ProductIndexLayout":Rt,"layouts/ProductShowLayout":qt,"pages/AbstractAccountPage":Bt,"pages/AbstractShopPage":Mt,"pages/AccountPage":Et,"pages/CartPage":Qt,"pages/OrderIndexPage":Ut,"pages/OrderShowPage":ar,"pages/ProductIndexPage":sr,"pages/ProductShowPage":ur,"utils/AccountControls":Pt},lr=e(23),pr=e.n(lr),dr=e(24),mr=e.n(dr),hr=function(){function t(){this.cart=null,this.loading=!1}var r=t.prototype;return r.priceTotal=function(){return this.cart?this.cart.priceTotal():null},r.productCount=function(){return this.cart?this.cart.productCount():null},r.boot=function(){this.cart=app.forum.cart()},r.load=function(){var t=this;this.loading=!0,app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/flamarkt/cart"}).then((function(r){t.loading=!1,t.cart=app.store.pushPayload(r),m.redraw()})).catch((function(r){throw t.loading=!1,m.redraw(),r}))},t}(),fr=e(25),vr=e.n(fr),yr=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).order=null,r}p(r,t);var e=r.prototype;return e.findType=function(){return"flamarkt/orders"},e.requestParams=function(){var r=t.prototype.requestParams.call(this);return r.bySlug=!0,r},e.show=function(t){this.order=t,app.setTitle(vr()(app.translator.trans("flamarkt-core.forum.order.browserTitle",{number:this.order.number()}))),app.setTitleCount(0)},e.view=function(){return Dt.component({order:this.order})},r}(V),gr=e(17),br=e.n(gr),wr=e(26),kr=e.n(wr);o.a.initializers.add("flamarkt-core",(function(){o.a.store.models["flamarkt-carts"]=v,o.a.store.models["flamarkt-orders"]=y,o.a.store.models["flamarkt-order-lines"]=g,o.a.store.models["flamarkt-products"]=b,pr.a.prototype.cart=h.a.hasOne("cart"),function(t){t.routes["flamarkt.account"]={path:"/account",component:Et},t.routes["flamarkt.account.orders"]={path:"/account/orders",component:Ut},t.routes["flamarkt.cart"]={path:"/cart",component:Qt},t.routes["flamarkt.products.index"]={path:"/products",component:sr},t.routes["flamarkt.products.show"]={path:"/products/:id",component:ur},t.routes["flamarkt.orders.show"]={path:"/orders/:id",component:yr},t.route.product=function(r){return t.route("flamarkt.products.show",{id:r.slug()})},t.route.order=function(r){return t.route("flamarkt.orders.show",{id:r.slug()})}}(o.a),o.a.cart=new hr,Object(a.extend)(o.a,"mount",(function(){o.a.cart.boot(),$("#home-link").click((function(t){t.ctrlKey||t.metaKey||2===t.which||o.a.session.user&&o.a.cart.load()}))})),Object(a.extend)(s.a.prototype,"items",(function(t){o.a.forum.attribute("backofficeUrl")&&t.add("flamarkt-backoffice",c.a.component({icon:"fas fa-shopping-cart",href:o.a.forum.attribute("backofficeUrl"),target:"_blank"},o.a.translator.trans("flamarkt-core.forum.nav.backoffice")))})),Object(a.extend)(wt.a.prototype,"navItems",(function(t){t.add("flamarkt-products",A.component({icon:"fas fa-shopping-cart",href:o.a.route("flamarkt.products.index"),activeRoutes:["flamarkt.products.*"]},o.a.translator.trans("flamarkt-core.forum.nav.shop"))),t.add("flamarkt-account",A.component({icon:"fas fa-user",href:o.a.route("flamarkt.account"),activeRoutes:["flamarkt.account.*","flamarkt.orders.show"]},o.a.translator.trans("flamarkt-core.forum.nav.account")))})),Object(a.extend)(mr.a.prototype,"items",(function(t){t.add("flamarkt-cart",ot.component({state:o.a.cart}),15)})),Object(a.extend)(br.a.prototype,"notificationTypes",(function(t){t.add("orderReceived",{name:"orderReceived",icon:"far fa-thumbs-up",label:o.a.translator.trans("flamarkt-core.forum.settings.notifyOrderReceived")})})),Object(a.override)(br.a.prototype,"preferenceKey",(function(t,r,e){return"orderReceived"===r&&"alert"===e?"__not_exists":t(r,e)})),Object(a.extend)(kr.a.prototype,"sourceItems",(function(t){t.add("products",new gt,-10)}))})),o.a.initializers.add("flamarkt-core-patch",(function(){Object(a.override)(h.a,"getIdentifier",(function(t,r){return r?t(r):null})),Object(a.override)(h.a,"hasOne",(function(t,r){return function(){if(this.data.relationships){var e=this.data.relationships[r];if(e&&!e.data)return null}return t(r).call(this)}})),Object(a.override)(h.a,"getIdentifier",(function(t,r){return r?r.verbatim?(delete r.verbatim,r):t(r):null}))}),100)}]);
//# sourceMappingURL=forum.js.map