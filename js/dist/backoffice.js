flarum.extensions["flamarkt-core"]=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=29)}([function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/components/Page"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["common/components/Select"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["common/helpers/highlight"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["admin/components/ExtensionPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Navigation"]},function(t,e){t.exports=flarum.core.compat["common/Application"]},function(t,e){t.exports=flarum.core.compat["admin/components/SessionDropdown"]},function(t,e){t.exports=flarum.core.compat["admin/components/AdminNav"]},function(t,e){t.exports=flarum.core.compat["admin/components/ExtensionLinkButton"]},function(t,e){t.exports=flarum.core.compat["common/components/Placeholder"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["common/components/TextEditor"]},function(t,e){t.exports=flarum.core.compat["common/helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,e){t.exports=flarum.core.compat["common/utils/classList"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/components/Link"]},function(t,e){t.exports=flarum.core.compat["common/resolvers/DefaultResolver"]},function(t,e){t.exports=flarum.core.compat["admin/utils/ExtensionData"]},function(t,e){t.exports=flarum.core.compat["admin/AdminApplication"]},function(t,e,r){"use strict";r.r(e),r.d(e,"app",(function(){return ie})),r.d(e,"common",(function(){return ne})),r.d(e,"backoffice",(function(){return oe}));var n=r(3),o=r.n(n);function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}var s=r(14),c=r.n(s),u=r(13),l=r.n(u),p=r(1),d=r.n(p),f=r(0),h=r.n(f),v=r(9),y=r.n(v),g=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.view=function(){return m("ul",{className:"Header-controls"},y()(this.items().toArray()))},r.config=function(t,e){e.retain=!0},r.items=function(){return new h.a},e}(d.a),b=r(2),w=r.n(b),k=r(15),x=r.n(k),D=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.view=function(){return m("ul",{className:"Header-controls"},y()(this.items().toArray()))},r.items=function(){var t=new h.a;return t.add("help",m(w.a,{href:"https://docs.flarum.org/troubleshoot.html",icon:"fas fa-question-circle",external:!0,target:"_blank"},app.translator.trans("core.admin.header.get_help"))),t.add("session",x.a.component()),t},e}(d.a),S=r(16),I=r.n(S),A=r(17),P=r.n(A),C=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.isActive=function(t){return m.route.get()===t.href||e.activeRoutes(t).some((function(t){var e=app.current.data.routeName;if(!e)return!1;var r=t.indexOf("*");return-1!==r?0===e.indexOf(t.substr(0,r)):e===t}))},e.activeRoutes=function(t){return t.activeRoutes?t.activeRoutes:[]},e}(w.a),F=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).query="",e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.query=""},r.items=function(){var t=this,e=new h.a;return e.add("dashboard",w.a.component({href:app.route("dashboard"),icon:"far fa-chart-bar"},app.translator.trans("flamarkt-core.backoffice.nav.dashboard")),80),e.add("users",C.component({href:app.route("users.index"),icon:"fas fa-user",activeRoutes:["users.*"]},app.translator.trans("flamarkt-core.backoffice.nav.users")),60),e.add("products",C.component({href:app.route("products.index"),icon:"fas fa-box",activeRoutes:["products.*"]},app.translator.trans("flamarkt-core.backoffice.nav.products")),40),e.add("orders",C.component({href:app.route("orders.index"),icon:"fas fa-shopping-cart",activeRoutes:["orders.*"]},app.translator.trans("flamarkt-core.backoffice.nav.orders")),20),e.add("search",m(".Search-input",m("input.FormControl.SearchBar",{type:"search",value:this.query,oninput:function(e){t.query=e.target.value},placeholder:app.translator.trans("flamarkt-core.backoffice.nav.searchPlaceholder")})),-10),e},r.extensions=function(){var t=[];return Object.keys(app.data.extensions).forEach((function(e){var r=app.data.extensions[e];r.extra["flamarkt-backoffice"]&&r.extra["flamarkt-backoffice"].showInBackoffice&&t.push(r)})),t},r.extensionItems=function(){var t=this,e=new h.a;return this.extensions().map((function(r){var n=t.query.toUpperCase(),o=r.extra["flarum-extension"].title;(!n||o.toUpperCase().includes(n)||r.description.toUpperCase().includes(n))&&e.add("extension-"+r.id,P.a.component({href:app.route("extension",{id:r.id}),extensionId:r.id,className:"ExtensionNavButton",title:r.description},o))})),e},e}(I.a),T=r(5),O=r.n(T),L=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.view=function(){return m(".DashboardPage",m(".container",m("p","Hello World")))},e}(O.a),N=r(6),R=r.n(N),E=r(4),B=r.n(E),M=r(18),U=r.n(M),q=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.items=function(t){var e;return(e=[]).concat.apply(e,t.pages.map((function(t){return t.items})))},r.topRow=function(t){return null},r.bottomRowContent=function(t){return t.loading?R.a.component():t.moreResults?B.a.component({className:"Button",onclick:t.loadMore.bind(t)},app.translator.trans("load-more")):0!==t.pages.length||t.loading?void 0:U.a.component({text:app.translator.trans("empty")})},r.bottomRow=function(t){var e=this.bottomRowContent(t);return e?m("tr",m("td",{colspan:100},e)):null},r.view=function(t){var e=this,r=t.attrs.state;return m("table.Table",[m("thead",m("tr",this.head().toArray())),m("tbody",[this.topRow(r),this.items(r).map((function(t){return e.row(t)})),this.bottomRow(r)])])},r.head=function(){var t=new h.a;return t.add("actions",m("th","Actions"),-100),t},r.row=function(t){return m("tr",this.rowAttrs(t),this.columns(t).toArray())},r.rowAttrs=function(t){return{}},r.columns=function(t){var e=new h.a;return e.add("actions",m("td",m("ul.Table-actions",y()(this.actions(t).toArray()))),-100),e},r.actions=function(t){return new h.a},e}(d.a),j=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.head=function(){var e=t.prototype.head.call(this);return e.add("title",m("th",app.translator.trans("flamarkt-core.backoffice.products.head.title")),10),e},r.columns=function(e){var r=t.prototype.columns.call(this,e);return r.add("title",m("td",e.title()),10),r},r.actions=function(e){var r=t.prototype.actions.call(this,e);return r.add("edit",w.a.component({className:"Button Button--icon",icon:"fas fa-pen",href:app.route.product(e)})),r},e}(q),H=function(t,e,r){void 0===r&&(r={}),this.number=void 0,this.items=void 0,this.links=void 0,this.number=t,this.items=e,this.links=r||{}},_=function(){function t(t){void 0===t&&(t={}),this.params={},this.pages=[],this.loading=!0,this.moreResults=!1,this.params=t}var e=t.prototype;return e.type=function(){return""},e.limit=function(){return 20},e.requestParams=function(){var t={filter:this.params.filter||{}};return this.params.sort&&(t.sort=this.params.sort),this.params.include&&(t.include=this.params.include),this.params.q&&(t.filter.q=this.params.q),t},e.clear=function(){this.pages=[],m.redraw()},e.refresh=function(t){var e=this,r=(void 0===t?{}:t).deferClear,n=void 0!==r&&r;return this.loading=!0,n||this.clear(),this.loadResults(0).then((function(t){e.pages=[],e.parseResults(t,0)}),(function(){e.loading=!1,m.redraw()}))},e.loadResults=function(t){var e=app.preloadedApiDocument();if(e)return Promise.resolve(e);var r=this.requestParams();return r.page={offset:t},app.store.find(this.type(),r)},e.loadMore=function(){var t=this;this.loading=!0;var e=this.pages.length;this.loadResults(e*this.limit()).then((function(r){t.parseResults(r,e)}))},e.parseResults=function(t,e){return t.length&&this.pages.push(new H(e,t,t.payload.links)),this.moreResults=t.payload.links&&!!t.payload.links.next,this.loading=!1,m.redraw(),t},e.remove=function(t){this.pages.forEach((function(e){var r=e.items.indexOf(t);-1!==r&&e.items.splice(r,1)}))},e.add=function(t){this.pages.length||this.pages.push(new H(1,[])),this.pages[0].items.unshift(t)},t}(),V=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.type=function(){return"flamarkt/products"},e}(_);function z(){return(z=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var Q=r(19),K=r.n(Q),X=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.view=function(){var t=this,e=this.options(),r=this.activeSort();return m(K.a,{className:"SortDropdown "+this.className(),buttonClassName:"Button",label:e[r]},Object.keys(e).map((function(r){var n=e[r],o=r===t.activeSort();return m(B.a,{icon:!o||"fas fa-check",onclick:function(){t.applySort(r)},active:o},n)})))},r.className=function(){return""},r.activeSort=function(){return this.attrs.state.params.sort||this.defaultSort()},r.applySort=function(t){var e=z({},m.route.param());if(this.defaultSort()===t?(delete this.attrs.state.params.sort,delete e.sort):(this.attrs.state.params.sort=t,e.sort=t),this.attrs.updateUrl){delete e.key;var r=app.current.data.routeName;m.route.set(app.route(r,e))}else this.attrs.state.refresh()},r.defaultSort=function(){return Object.keys(this.options())[0]},e}(d.a),Y=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.className=function(){return"ProductSortDropdown"},r.options=function(){return{"-createdAt":app.translator.trans("flamarkt-core.lib.sort.products.createdAtDesc"),createdAt:app.translator.trans("flamarkt-core.lib.sort.products.createdAtAsc"),price:app.translator.trans("flamarkt-core.lib.sort.products.priceAsc"),"-price":app.translator.trans("flamarkt-core.lib.sort.products.priceDesc"),title:app.translator.trans("flamarkt-core.lib.sort.products.titleAsc"),"-title":app.translator.trans("flamarkt-core.lib.sort.products.titleDesc")}},e}(X),$=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).state=void 0,e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.initState(),this.state.refresh(),app.setTitle(app.translator.trans("flamarkt-core.backoffice.products.title")),app.setTitleCount(0)},r.initState=function(){var t=m.route.param();return new V({sort:t.sort})},r.view=function(){return m(".ProductIndexPage",m(".container",[m(".Form-group",[w.a.component({className:"Button",href:app.route("products.show",{id:"new"})},app.translator.trans("flamarkt-core.backoffice.products.new")),m(Y,{state:this.state})]),m(j,{state:this.state})]))},e}(O.a),G=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.load()},r.load=function(){var t=this,e=app.preloadedApiDocument(),r=m.route.param("id");if("new"===r){var n=this.newRecord();n&&this.show(n)}else if(e instanceof o.a)this.show(e);else{var a=this.requestParams();app.store.find(this.findType(),r,a).then((function(e){t.show(e),m.redraw()}))}},r.newRecord=function(){return null},r.findType=function(){return""},r.requestParams=function(){return{}},r.show=function(t){},r.saveThroughNewRecord=function(t,e){var r=this.newRecord();return r?(t&&(r.pushData({id:t}),r.exists=!0),r.save(e)):Promise.reject()},e}(O.a);var W=["exists","dirty"],J=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.view=function(t){var e=t.attrs,r=e.exists,n=void 0!==r&&r,o=e.dirty,a=void 0===o||o,i=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(e,W),s="";return s=(Array.isArray(t.children)?t.children.some((function(t){return t})):t.children)?t.children:n?a?"Save":"Saved":"Create",B.a.component(z({type:"submit",className:"Button Button--primary",disabled:n&&!a},i),s)},e}(d.a),Z=r(20),tt=r.n(Z),et=r(7),rt=r.n(et),nt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).saving=!1,e}return i(e,t),e.prototype.view=function(){var t=this,e=this.attrs.model;return e.exists?m(B.a,{className:"Button",icon:e.isHidden()?"fas fa-eye":"fas fa-eye-slash",onclick:function(){t.saving=!0,e.save({isHidden:!e.isHidden()}).then((function(){t.saving=!1,m.redraw()})).catch((function(e){throw t.saving=!1,m.redraw(),e}))}},e.isHidden()?"Restore":"Soft Delete"):null},e}(d.a),ot=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).saving=!1,e}return i(e,t),e.prototype.view=function(){var t=this,e=this.attrs.model;return e.isHidden()?m(B.a,{className:"Button",icon:"fas fa-trash",onclick:function(){confirm("Are you sure you want to permanently delete this record?")&&(t.saving=!0,e.delete().then((function(){t.saving=!1,m.redraw(),t.attrs.afterdelete()})).catch((function(e){throw t.saving=!1,m.redraw(),e})))}},"Delete Permanently"):null},e}(d.a),at=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.decimals=function(){return this.attrs.decimals||0},r.min=function(){return this.attrs.min},r.max=function(){return this.attrs.max},r.step=function(){return this.attrs.step},r.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},r.toIntegerValue=function(t){return Math.round(t*Math.pow(10,this.decimals()))},r.view=function(){var t=this,e={type:"number",value:this.fromIntegerValue(this.attrs.value)+"",onchange:function(e){var r=parseFloat(e.target.value);t.attrs.onchange(t.toIntegerValue(r))}},r=this.min();void 0!==r&&(e.min=this.fromIntegerValue(r));var n=this.max();void 0!==n&&(e.max=this.fromIntegerValue(n));var o=this.step();return void 0!==o?e.step=this.fromIntegerValue(o):this.decimals()>0&&(e.step=1/Math.pow(10,this.decimals())),m("input.FormControl",e)},e}(d.a),it=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.decimals=function(){return app.forum.attribute("priceDecimals")},e}(at),st=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).product=null,e.saving=!1,e.dirty=!1,e.title="",e.description="",e.price=0,e.availabilityDriver=null,e.priceDriver=null,e.composer={editor:null},e}i(e,t);var r=e.prototype;return r.newRecord=function(){return app.store.createRecord("flamarkt-products",{attributes:{}})},r.findType=function(){return"flamarkt/products"},r.show=function(t){this.product=t,this.title=t.title()||"",this.description=t.description()||"",this.price=t.priceEdit()||0,this.availabilityDriver=t.attribute("availabilityDriver"),this.priceDriver=t.attribute("priceDriver"),app.setTitle(t.title()),app.setTitleCount(0)},r.view=function(){return this.product?m("form.ProductShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container.container--narrow",this.fields().toArray())):R.a.component()},r.fields=function(){var t=this,e=new h.a;return app.composer=this.composer,e.add("title",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.products.field.title")),m("input.FormControl",{type:"text",value:this.title,oninput:function(e){t.title=e.target.value,t.dirty=!0},disabled:this.saving})]),50),e.add("description",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.products.field.description")),m(".FormControl.FormControl--editor",tt.a.component({value:this.description,onchange:function(e){t.description=e,t.dirty=!0,m.redraw()},disabled:this.saving,composer:this.composer}))]),40),e.add("price",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.products.field.price")),m(it,{value:this.price,onchange:function(e){t.price=e,t.dirty=!0},disabled:this.saving})]),30),e.add("availabilityDriver",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.products.field.availabilityDriver")),rt.a.component({value:this.availabilityDriver||"_default",options:this.availabilityDriverOptions(),onchange:function(e){t.availabilityDriver="_default"===e?null:e,t.dirty=!0}})]),20),e.add("priceDriver",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.products.field.priceDriver")),rt.a.component({value:this.priceDriver||"_default",options:this.priceDriverOptions(),onchange:function(e){t.priceDriver="_default"===e?null:e,t.dirty=!0}})]),10),e.add("submit",m(".Form-group",[J.component({loading:this.saving,dirty:this.dirty,exists:this.product.exists})," ",nt.component({model:this.product})," ",ot.component({model:this.product,afterdelete:function(){m.route.set(app.route("products.index"))}})]),-10),e},r.availabilityDriverOptions=function(){var t={_default:"Default"};return(app.forum.attribute("flamarktAvailabilityDrivers")||[]).forEach((function(e){t[e]=e})),t},r.priceDriverOptions=function(){var t={_default:"Default"};return(app.forum.attribute("flamarktPriceDrivers")||[]).forEach((function(e){t[e]=e})),t},r.data=function(){return{title:this.title,description:this.description,price:this.price,availabilityDriver:this.availabilityDriver,priceDriver:this.priceDriver}},r.onsubmit=function(t){var e,r=this;t.preventDefault(),this.saving=!0,this.saveThroughNewRecord(null==(e=this.product)?void 0:e.id(),this.data()).then((function(t){r.product=t,r.saving=!1,r.dirty=!1,m.redraw(),m.route.set(app.route.product(t))})).catch((function(t){throw r.saving=!1,m.redraw(),t}))},e}(G),ct=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.type=function(){return"flamarkt/orders"},e}(_),ut=r(11),lt=r.n(ut),pt=r(21),dt=r.n(pt),mt=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.decimals=function(){return this.attrs.decimals||0},r.fromIntegerValue=function(t){return t/Math.pow(10,this.decimals())},r.view=function(){return this.fromIntegerValue(this.attrs.value).toFixed(this.decimals())},e}(d.a),ft=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.decimals=function(){return app.forum.attribute("priceDecimals")},r.view=function(){return[t.prototype.view.call(this)," ",app.forum.attribute("priceUnit")]},e}(mt),ht=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.head=function(){var e=t.prototype.head.call(this);return e.add("number",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.number")),50),e.add("date",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.date")),40),e.add("user",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.user")),30),e.add("priceTotal",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.priceTotal")),20),e.add("paidAmount",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.paidAmount")),10),e.add("productCount",m("th",app.translator.trans("flamarkt-core.backoffice.orders.head.productCount")),5),e},r.columns=function(e){var r=t.prototype.columns.call(this,e);return r.add("number",m("td",e.number()),50),r.add("date",m("td",dt()(e.createdAt())),40),r.add("user",m("td",lt()(e.user())),30),r.add("priceTotal",m("td",m(ft,{value:e.priceTotal()})),20),r.add("paidAmount",m("td",m(ft,{value:e.paidAmount()})),10),r.add("productCount",m("td",e.productCount()),5),r},r.actions=function(e){var r=t.prototype.actions.call(this,e);return r.add("edit",w.a.component({className:"Button Button--icon",icon:"fas fa-pen",href:app.route.order(e)})),r},e}(q),vt=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.className=function(){return"OrderSortDropdown"},r.options=function(){return{"-createdAt":"Newest",createdAt:"Oldest","-priceTotal":"Highest total",priceTotal:"Lowest total"}},e}(X),yt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).state=void 0,e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.initState(),this.state.refresh(),app.setTitle(app.translator.trans("flamarkt-core.backoffice.orders.title")),app.setTitleCount(0)},r.initState=function(){var t=m.route.param(),e={sort:t.sort};return t.user&&(e.filter=e.filter||{},e.filter.user=t.user),new ct(e)},r.view=function(){return m(".OrderIndexPage",m(".container",[m(".Form-group",[w.a.component({className:"Button",href:app.route("orders.show",{id:"new"})},app.translator.trans("flamarkt-core.backoffice.orders.new")),m(vt,{state:this.state})]),m(ht,{state:this.state})]))},e}(O.a),gt=function(){function t(){this.sortingIndex=null,this.showPlaceholderForIndex=0,this.dragoverenterhandler=void 0,this.drophandler=void 0}var e=t.prototype;return e.oncreate=function(t){var e=this;this.dragoverenterhandler=function(r){if(null!==e.sortingIndex){r.preventDefault(),r.stopPropagation(),r.dataTransfer.dropEffect="move";var n=0;t.dom.childNodes.forEach((function(e){var o=parseInt(e.dataset.index||"");if(!isNaN(o)){var a=e.getBoundingClientRect();if("horizontal"===t.attrs.direction){if(!a.width)return;var i=a.left+a.width/2;r.pageX>i+window.scrollX&&(n=o+1)}else{if(!a.height)return;var s=a.top+a.height/2;r.pageY>s+window.scrollY&&(n=o+1)}}})),n!==e.showPlaceholderForIndex&&(e.showPlaceholderForIndex=n,m.redraw())}},document.addEventListener("dragover",this.dragoverenterhandler),document.addEventListener("dragenter",this.dragoverenterhandler),this.drophandler=function(r){if(null!==e.sortingIndex){r.preventDefault(),r.stopPropagation();var n=e.sortingIndex,o=e.showPlaceholderForIndex-(e.showPlaceholderForIndex>e.sortingIndex?1:0);e.sortingIndex=null,m.redraw(),o!==n&&t.attrs.onsort(n,o)}},document.addEventListener("drop",this.drophandler)},e.onremove=function(){document.removeEventListener("dragover",this.dragoverenterhandler),document.removeEventListener("dragenter",this.dragoverenterhandler),document.removeEventListener("drop",this.drophandler)},e.view=function(t){var e=this,r=[];t.children.forEach((function(n,o){null!==e.sortingIndex&&e.showPlaceholderForIndex===o&&r.push(e.placeholder(t)),o===e.sortingIndex&&(n.attrs.style||(n.attrs.style={}),n.attrs.style.display="none"),n.attrs["data-index"]=o,n.attrs.ondragstart=function(r){if(r.target&&r.dataTransfer){var n=t.attrs.handleClassName;if(void 0===n&&(n="js-handle"),n&&!r.target.classList.contains(n)||t.attrs.disabled)r.redraw=!1;else{var a=Array.from(t.dom.childNodes).find((function(t){return t.dataset.index===o+""}));if(!a)return;var i=a.getBoundingClientRect();r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",o+""),r.dataTransfer.setDragImage(a,r.pageX-i.left-window.scrollX,r.pageY-i.top-window.scrollY),e.sortingIndex=o,e.showPlaceholderForIndex=o}}},r.push(n)})),null!==this.sortingIndex&&this.showPlaceholderForIndex===t.children.length&&r.push(this.placeholder(t));var n={};return t.attrs.className&&(n.className=t.attrs.className),m(t.attrs.containerTag||"div",n,r)},e.placeholder=function(t){return m(t.attrs.placeholderTag||"div",{className:"SortablePlaceholder",key:"placeholder"},"tr"===t.attrs.placeholderTag?m("td",{colspan:100}):null)},t}(),bt=r(22),wt=r.n(bt),kt=function(){function t(){}return t.prototype.view=function(t){var e={className:(t.attrs.className?t.attrs.className+" ":"")+"js-handle"};return t.attrs.disabled?e.className+=" disabled":e.draggable="true",m(t.attrs.elementTag||"div",e,wt()("fas fa-grip-lines"))},t}(),xt=function(){function t(){this.callbacks=new Map,this.whenCallback=function(t){return!0}}var e=t.prototype;return e.onUp=function(t){return this.callbacks.set(38,(function(e){e.preventDefault(),t(e)})),this},e.onDown=function(t){return this.callbacks.set(40,(function(e){e.preventDefault(),t(e)})),this},e.onSelect=function(t){var e=function(e){e.preventDefault(),t(e)};return this.callbacks.set(9,e),this.callbacks.set(13,e),this},e.onCancel=function(t){return this.callbacks.set(27,(function(e){e.stopPropagation(),e.preventDefault(),t(e)})),this},e.onRemove=function(t){return this.callbacks.set(8,(function(e){0===e.target.selectionStart&&0===e.target.selectionEnd&&(t(e),e.preventDefault())})),this},e.when=function(t){return this.whenCallback=t,this},e.bindTo=function(t){t.on("keydown",this.navigate.bind(this))},e.navigate=function(t){if(this.whenCallback(t)){var e=this.callbacks.get(t.which);e&&e(t)}},t}(),Dt=r(23),St=r.n(Dt),It=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).searchFilter="",e.debouncedSearchFilter="",e.searchDebouncer=void 0,e.activeListIndex=0,e.inputIsFocused=!1,e.navigator=void 0,e.dropdownIsFocused=!1,e.onmousedown=void 0,e}i(e,t);var r=e.prototype;return r.className=function(){return""},r.normalizedValue=function(){return Array.isArray(this.attrs.relationship)?this.attrs.relationship:this.attrs.relationship?[this.attrs.relationship]:[]},r.setValue=function(t){this.attrs.hasOne?this.attrs.onchange(t.length?t[0]:null):this.attrs.onchange(t)},r.oninit=function(e){var r=this;t.prototype.oninit.call(this,e),this.navigator=new xt,this.navigator.onUp((function(){return r.setIndex(r.activeListIndex-1,!0)})).onDown((function(){return r.setIndex(r.activeListIndex+1,!0)})).onSelect(this.select.bind(this)).onRemove((function(){var t=r.normalizedValue();t.length&&r.toggleModel(t[t.length-1])})).when((function(t){return" "===t.key&&""===r.searchFilter?(t.preventDefault(),r.select(t),!1):"Tab"!==t.key}))},r.oncreate=function(e){var r=this;t.prototype.oncreate.call(this,e),this.element=e.dom,this.onmousedown=function(t){var n=e.dom.querySelector(".Dropdown-menu");n&&n.contains(t.target)?r.dropdownIsFocused||(r.dropdownIsFocused=!0,m.redraw()):r.dropdownIsFocused&&(r.dropdownIsFocused=!1,m.redraw())},document.addEventListener("mousedown",this.onmousedown)},r.onremove=function(e){t.prototype.onremove.call(this,e),document.removeEventListener("mousedown",this.onmousedown)},r.indexInSelectedModels=function(t){return this.normalizedValue().findIndex((function(e){return e.id()===t.id()}))},r.addModel=function(t){if(this.attrs.hasOne)this.setValue([t]);else{var e=this.normalizedValue();e.push(t),this.setValue(e)}},r.removeModel=function(t){var e=this.indexInSelectedModels(t);if(-1!==e){var r=this.normalizedValue();r.splice(e,1),this.setValue(r)}},r.view=function(){return m(".RelationshipSelect",{className:this.className()},[m(".RelationshipSelect-Form",this.formItems().toArray()),this.listAvailableModels(this.results(this.debouncedSearchFilter))])},r.formItems=function(){var t=new h.a;return t.add("input",m(".RelationshipSelect-FakeInput-Wrapper",m(".RelationshipSelect-FakeInput.FormControl",{className:this.inputIsFocused?"focus":""},this.inputItems().toArray())),20),t},r.inputItems=function(){var t=this,e=new h.a;return e.add("selected",this.normalizedValue().map((function(e){return m("span.RelationshipSelect-Selected",{onclick:function(){t.toggleModel(e),t.onready()}},t.item(e))})),20),e.add("control",m("input.FormControl",{placeholder:this.attrs.placeholder,value:this.searchFilter,oninput:function(e){t.searchFilter=e.target.value,t.activeListIndex=0,clearTimeout(t.searchDebouncer),t.searchDebouncer=setTimeout((function(){t.debouncedSearchFilter=t.searchFilter,t.search(t.debouncedSearchFilter)}),300)},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:this.oninputfocus.bind(this),onblur:this.oninputblur.bind(this)}),10),e},r.oninputfocus=function(){this.inputIsFocused=!0,""===this.debouncedSearchFilter&&this.search(this.debouncedSearchFilter)},r.oninputblur=function(){this.inputIsFocused=!1},r.listAvailableModels=function(t){return!this.inputIsFocused&&!this.dropdownIsFocused||Array.isArray(t)&&0===t.length?null:(e=null===t?R.a.component():t.map(this.listAvailableModel.bind(this)),m("ul.Dropdown-menu.RelationshipSelect-Dropdown",e));var e},r.listAvailableModel=function(t,e){var r=this;return m("li.RelationshipSelect-Dropdown-Item",{"data-index":e,className:St()({selected:-1!==this.indexInSelectedModels(t),active:this.activeListIndex===e}),onmouseover:function(){return r.activeListIndex=e},onclick:this.toggleModel.bind(this,t)},m(".RelationshipSelect-Dropdown-Item-Wrap",this.item(t,this.debouncedSearchFilter)))},r.toggleModel=function(t){var e=this;-1!==this.indexInSelectedModels(t)?this.removeModel(t):this.addModel(t),this.searchFilter&&(this.searchFilter="",this.debouncedSearchFilter="",this.activeListIndex=0),setTimeout((function(){e.onready()}))},r.select=function(t){var e=this.getDomElement(this.activeListIndex);if(!e.length)return this.searchFilter="",void(this.debouncedSearchFilter="");e[0].dispatchEvent(new Event("click"))},r.getDomElement=function(t){return this.$('.RelationshipSelect-Dropdown-Item[data-index="'+t+'"]')},r.setIndex=function(t,e){var r=this.$(".RelationshipSelect-Dropdown"),n=this.$(".RelationshipSelect-Dropdown-Item").length;t<0?t=n-1:t>=n&&(t=0);var o=this.getDomElement(t);if(this.activeListIndex=t,m.redraw(),e){var a,i,s,c=r.scrollTop()||0,u=(null==(a=r.offset())?void 0:a.top)||0,l=u+(r.outerHeight()||0),p=(null==(i=o.offset())?void 0:i.top)||0,d=p+(o.outerHeight()||0);p<u?s=c-u+p-parseInt(r.css("padding-top"),10):d>l&&(s=c-l+d+parseInt(r.css("padding-bottom"),10)),void 0!==s&&r.stop(!0).animate({scrollTop:s},100)}},r.onready=function(){this.$("input").first().focus().select()},e}(d.a),At=r(10),Pt=r.n(At),Ct=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).resultsCache=new Map,e}i(e,t);var r=e.prototype;return r.search=function(t){var e=this;return t?app.store.find("flamarkt/products",{filter:{q:t},page:{limit:5}}).then((function(r){e.resultsCache.set(t,r),m.redraw()})):(m.redraw(),Promise.resolve())},r.results=function(t){if(!t)return[];t=t.toLowerCase();var e=this.resultsCache.get(t);return void 0===e?null:(e||[]).concat(app.store.all("flamarkt-products").filter((function(e){return e.title().toLowerCase().substr(0,t.length)===t}))).filter((function(t,e,r){return r.lastIndexOf(t)===e})).sort((function(t,e){return t.title().localeCompare(e.title())}))},r.item=function(t,e){return[e?Pt()(t.title(),e):t.title()]},e}(It),Ft=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(at),Tt=function(){function t(){}var e=t.prototype;return e.view=function(t){var e=t.attrs,r=e.line,n=e.control,o=e.onchange,a=e.sortable,i=e.style,s=e.ondragstart;return m("tr",{style:i,"data-index":t.attrs["data-index"],ondragstart:s},this.columns(r,n,o,a).toArray())},e.columns=function(t,e,r,n){var o=new h.a;return o.add("handle",m("td.OrderLineEdit-Handle",n?m(kt):null),100),o.add("group",m("td.OrderLineEdit-Group",rt.a.component({value:null===t.group?"_none":t.group,onchange:function(e){t.group="_none"===e?null:e,r()},options:{_none:"None",shipping:"Shipping"}})),90),o.add("type",m("td.OrderLineEdit-Type",rt.a.component({value:t.type,onchange:function(e){t.type=e,r()},options:{product:"Product",manual:"Manual"}})),80),o.add("info",m("td.OrderLineEdit-Info",this.fields(t,r).toArray()),30),o.add("priceUnit",m("td.OrderLineEdit-PriceUnit",m(it,{value:t.priceUnit,onchange:function(e){t.priceUnit=e,t.updateTotal(),r()},product:t.product})),-30),o.add("quantity",m("td.OrderLineEdit-Quantity",m(Ft,{value:t.quantity,onchange:function(e){t.quantity=e,t.updateTotal(),r()},product:t.product})),-60),o.add("priceTotal",m("td.OrderLineEdit-PriceTotal",m(ft,{value:t.priceTotal,product:t.product})),-90),o.add("control",m("td.OrderLineEdit-Controls",e),-100),o},e.showInfoProduct=function(t){return"product"===t.type},e.showInfoLabel=function(t){return"manual"===t.type},e.showInfoComment=function(t){return"product"===t.type||"manual"===t.type},e.fields=function(t,e){var r=new h.a;return this.showInfoProduct(t)&&r.add("product",m(".Form-group",[m("label","Product"),m(Ct,{relationship:t.product,onchange:function(r){t.product=r,e()},hasOne:!0})])),this.showInfoLabel(t)&&r.add("label",m(".Form-group",[m("label","Label"),m("input.FormControl",{type:"text",value:t.label,onchange:function(r){t.label=r.target.value,e()}})])),this.showInfoComment(t)&&r.add("comment",m(".Form-group",[m("label","Comment"),m("textarea.FormControl",{value:t.comment,onchange:function(r){t.comment=r.target.value,e()}})])),r},t}(),Ot=r(24),Lt=r.n(Ot),Nt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).resultsCache=new Map,e}i(e,t);var r=e.prototype;return r.className=function(){return"UserRelationshipSelect"},r.search=function(t){var e=this;return t?app.store.find("users",{filter:{q:t},page:{limit:5}}).then((function(r){e.resultsCache.set(t,r),m.redraw()})):(m.redraw(),Promise.resolve())},r.results=function(t){if(!t)return[];t=t.toLowerCase();var e=this.resultsCache.get(t);return void 0===e?null:(e||[]).concat(app.store.all("users").filter((function(e){return[e.username(),e.displayName()].some((function(e){return e.toLowerCase().substr(0,t.length)===t}))}))).filter((function(t,e,r){return r.lastIndexOf(t)===e})).sort((function(t,e){return t.displayName().localeCompare(e.displayName())}))},r.item=function(t,e){var r=lt()(t);return[Lt()(t),e?z({},r,{text:void 0,children:[Pt()(r.text,e)]}):r]},e}(It),Rt=0,Et=function(){function t(){this.uniqueFormKey=void 0,this.line=void 0,this.group=null,this.type=null,this.label="",this.comment="",this.quantity=0,this.priceUnit=0,this.priceTotal=0,this.product=null,this.uniqueFormKey=++Rt+""}var e=t.prototype;return e.init=function(t){this.line=t,this.group=t.group()||null,this.type=t.type()||null,this.label=t.label()||"",this.comment=t.comment()||"",this.quantity=t.quantity()||0,this.priceUnit=t.priceUnit()||0,this.priceTotal=t.priceTotal()||0,this.product=t.product()||null},e.updateTotal=function(){this.priceTotal=this.quantity*this.priceUnit},e.data=function(){var t={attributes:{group:this.group,type:this.type,label:this.label,comment:this.comment,quantity:this.quantity,priceUnit:this.priceUnit},relationships:{product:{data:o.a.getIdentifier(this.product)}}};return this.line&&(t.id=this.line.id()),t},t}(),Bt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).order=null,e.user=null,e.lines=[],e.saving=!1,e.dirty=!1,e.newLine=void 0,e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.initNewLine()},r.initNewLine=function(){this.newLine=new Et},r.initLineState=function(t){var e=new Et;return e.init(t),e},r.newRecord=function(){return app.store.createRecord("flamarkt-orders")},r.findType=function(){return"flamarkt/orders"},r.show=function(t){this.order=t,this.user=t.user()||null,this.lines=(t.lines()||[]).map(this.initLineState),app.setTitleCount(0)},r.view=function(){return this.order?m("form.OrderShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container.container--narrow",this.fields().toArray())):R.a.component()},r.fields=function(){var t=this,e=new h.a;return e.add("number",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.orders.field.number")),m("input.FormControl",{value:this.order.number(),readonly:!0})]),30),e.add("user",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.orders.field.user")),m(Nt,{relationship:this.user,onchange:function(e){t.user=e,t.dirty=!0},hasOne:!0})]),20),e.add("lines",m("table.OrderComposerTable",[m("thead",m("tr",this.tableHead().toArray())),m(gt,{containerTag:"tbody",placeholderTag:"tr",onsort:function(e,r){var n;(n=t.lines).splice.apply(n,[r,0].concat(t.lines.splice(e,1))),t.dirty=!0}},this.lines.map((function(e,r){return m(Tt,{key:e.uniqueFormKey,line:e,sortable:!0,control:B.a.component({icon:"fas fa-times",className:"Button Button--icon Button--delete",onclick:function(){t.lines.splice(r,1),t.dirty=!0},title:app.translator.trans("flamarkt-core.backoffice.orders.lines.control.delete")}),onchange:function(){t.dirty=!0}})}))),m("tbody",m(Tt,{key:"new",line:this.newLine,control:B.a.component({icon:"fas fa-plus",className:"Button Button--icon",onclick:function(){t.lines.push(t.newLine),t.dirty=!0,t.initNewLine()},title:app.translator.trans("flamarkt-core.backoffice.orders.lines.control.add")}),onchange:function(){t.dirty=!0}}))]),10),e.add("submit",m(".Form-group",[J.component({loading:this.saving,dirty:this.dirty,exists:this.order.exists})," ",nt.component({model:this.order})," ",ot.component({model:this.order,afterdelete:function(){m.route.set(app.route("orders.index"))}})]),-10),e},r.tableHead=function(){var t=new h.a;return t.add("handle",m("th"),100),t.add("group",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.group")),90),t.add("type",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.type")),80),t.add("info",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.info")),30),t.add("priceUnit",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.priceUnit")),-30),t.add("quantity",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.quantity")),-60),t.add("priceTotal",m("th",app.translator.trans("flamarkt-core.backoffice.orders.lines.head.priceTotal")),-90),t.add("control",m("th"),-100),t},r.data=function(){return{relationships:{lines:this.lines.map((function(t){return z({verbatim:!0,type:"flamarkt-product-lines"},t.data())})),user:this.user}}},r.onsubmit=function(t){var e,r=this;t.preventDefault(),this.saving=!0,this.saveThroughNewRecord(null==(e=this.order)?void 0:e.id(),this.data()).then((function(t){r.order=t,r.saving=!1,r.dirty=!1,m.redraw(),m.route.set(app.route.order(t))})).catch((function(t){r.saving=!1,m.redraw()}))},e}(G),Mt=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.type=function(){return"users"},e}(_),Ut=r(25),qt=r.n(Ut),jt=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.head=function(){var e=t.prototype.head.call(this);return e.add("email",m("th",app.translator.trans("flamarkt-core.backoffice.users.head.email")),10),e.add("orders",m("th",app.translator.trans("flamarkt-core.backoffice.users.head.orders")),10),e},r.columns=function(e){var r=t.prototype.columns.call(this,e);return r.add("email",m("td",e.email()),10),r.add("orders",m("td",m(qt.a,{href:app.route("orders.index")+"?"+m.buildQueryString({user:e.slug()})},e.flamarktOrderCount())),10),r},r.actions=function(e){var r=t.prototype.actions.call(this,e);return r.add("edit",w.a.component({className:"Button Button--icon",icon:"fas fa-pen",href:app.route.user(e)})),r},e}(q),Ht=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.className=function(){return"UserSortDropdown"},r.options=function(){return{default:"Default sort","-joinedAt":"Newest",joinedAt:"Oldest","-lastSeenAt":"Seen recently",lastSeenAt:"Seen least recently",username:"Username ASC","-username":"Username DESC",commentCount:"Comment count ASC","-commentCount":"Comment count DESC",discussionCount:"Discussion count ASC","-discussionCount":"Discussion count DESC"}},e}(X),_t=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).state=void 0,e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.initState(),this.state.refresh(),app.setTitle(app.translator.trans("flamarkt-core.backoffice.users.title")),app.setTitleCount(0)},r.initState=function(){var t=m.route.param();return new Mt({sort:t.sort})},r.view=function(){return m(".UserIndexPage",m(".container",[m(".Form-group",[w.a.component({className:"Button",href:app.route("users.show",{id:"new"})},app.translator.trans("flamarkt-core.backoffice.users.new")),m(Ht,{state:this.state})]),m(jt,{state:this.state})]))},e}(O.a),Vt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).user=null,e.saving=!1,e.dirty=!1,e.username="",e.password="",e.email="",e}i(e,t);var r=e.prototype;return r.newRecord=function(){return app.store.createRecord("users",{attributes:{}})},r.findType=function(){return"users"},r.show=function(t){this.user=t,this.username=t.username()||"",this.email=t.email()||"",app.setTitle(t.email()),app.setTitleCount(0)},r.view=function(){return this.user?m("form.UserShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container.container--narrow",this.fields().toArray())):R.a.component()},r.fields=function(){var t=this,e=new h.a;return e.add("username",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.users.field.username")),m("input.FormControl",{type:"text",value:this.username,oninput:function(e){t.username=e.target.value,t.dirty=!0},disabled:this.saving})])),e.add("email",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.users.field.email")),m("input.FormControl",{type:"email",value:this.email,oninput:function(e){t.email=e.target.value,t.dirty=!0},disabled:this.saving||app.session.user===this.user})])),this.user.exists||e.add("password",m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.users.field.password")),m("input.FormControl",{type:"password",value:this.password,oninput:function(e){t.password=e.target.value,t.dirty=!0},disabled:this.saving})])),e.add("submit",m(".Form-group",[J.component({loading:this.saving,dirty:this.dirty,exists:this.user.exists})]),-10),e},r.data=function(){var t={username:this.username};return this.email!==this.user.email()&&(t.email=this.email),this.password&&(t.password=this.password),t},r.onsubmit=function(t){var e=this;t.preventDefault(),this.saving=!0,this.user.save(this.data()).then((function(t){e.user=t,e.saving=!1,e.dirty=!1,m.redraw(),m.route.set(app.route.user(t))})).catch((function(t){e.saving=!1,m.redraw()}))},e}(G),zt=r(12),Qt=r.n(zt),Kt=r(26),Xt=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.onmatch=function(e,r,n){var o=app.extensionData.getPage(e.id);return o||t.prototype.onmatch.call(this,e,r,n)},e}(r.n(Kt).a);Xt.extension=null;var Yt=r(27),$t=r.n(Yt),Gt=r(28),Wt=r.n(Gt),Jt=function(t){function e(){var e;return(e=t.call(this)||this).extensionData=new $t.a,e.history={canGoBack:function(){return!0},getPrevious:function(){},backUrl:function(){return e.forum.attribute("baseUrl")},back:function(){window.location=this.backUrl()}},function(t){t.routes={dashboard:{path:"/dashboard",component:L},"products.index":{path:"/products",component:$},"products.show":{path:"/products/:id",component:st},"orders.index":{path:"/orders",component:yt},"orders.show":{path:"/orders/:id",component:Bt},"users.index":{path:"/users",component:_t},"users.show":{path:"/users/:id",component:Vt},extension:{path:"/extension/:id",component:Qt.a,resolverClass:Xt}},t.route.product=function(e){return t.route("products.show",{id:e.id()})},t.route.user=function(e){return t.route("users.show",{id:e.id()})},t.route.order=function(e){return t.route("orders.show",{id:e.id()})}}(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)),e}i(e,t);var r=e.prototype;return r.mount=function(){var e=this.forum.attribute("defaultRoute"),r="dashboard";for(var n in this.routes)this.routes[n].path===e&&(r=n);this.routes[r].path="/",m.route.prefix="/backoffice",t.prototype.mount.call(this,this.forum.attribute("basePath")),m.mount(document.getElementById("app-navigation"),{view:function(){return l.a.component({className:"App-backControl",drawer:!0})}}),m.mount(document.getElementById("header-navigation"),l.a),m.mount(document.getElementById("header-primary"),g),m.mount(document.getElementById("header-secondary"),D),m.mount(document.getElementById("admin-navigation"),F)},r.getRequiredPermissions=function(t){return Wt.a.prototype.getRequiredPermissions.call(this,t)},e}(c.a),Zt=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.attribute=function(t,e){return o.a.attribute(t,e)},e.hasOne=function(t){return o.a.hasOne(t)},e.hasMany=function(t){return o.a.hasMany(t)},e}(o.a),te=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).number=Zt.attribute("number"),e.slug=Zt.attribute("slug"),e.productCount=Zt.attribute("productCount"),e.priceTotal=Zt.attribute("priceTotal"),e.paidAmount=Zt.attribute("paidAmount"),e.createdAt=Zt.attribute("createdAt",Zt.transformDate),e.isHidden=Zt.attribute("isHidden"),e.user=Zt.hasOne("user"),e.lines=Zt.hasMany("lines"),e.payments=Zt.hasMany("payments"),e}return i(e,t),e.prototype.apiEndpoint=function(){return"/flamarkt/orders"+(this.exists?"/"+this.data.id:"")},e}(Zt),ee=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).number=Zt.attribute("number"),e.group=Zt.attribute("group"),e.type=Zt.attribute("type"),e.label=Zt.attribute("label"),e.comment=Zt.attribute("comment"),e.quantity=Zt.attribute("quantity"),e.priceUnit=Zt.attribute("priceUnit"),e.priceTotal=Zt.attribute("priceTotal"),e.product=Zt.hasOne("product"),e}return i(e,t),e}(Zt),re=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).title=Zt.attribute("title"),e.slug=Zt.attribute("slug"),e.description=Zt.attribute("description"),e.descriptionHtml=Zt.attribute("descriptionHtml"),e.price=Zt.attribute("price"),e.priceEdit=Zt.attribute("priceEdit"),e.cartQuantity=Zt.attribute("cartQuantity"),e.isHidden=Zt.attribute("isHidden"),e.canOrder=Zt.attribute("canOrder"),e.canEdit=Zt.attribute("canEdit"),e}i(e,t);var r=e.prototype;return r.cartPriceTotalLocal=function(){return this.price&&this.cartQuantity?this.price()*this.cartQuantity():0},r.apiEndpoint=function(){return"/flamarkt/products"+(this.exists?"/"+this.data.id:"")},e}(Zt),ne={"components/AbstractSortDropdown":X,"components/ActiveLinkButton":C,"components/DecimalInput":at,"components/DecimalLabel":mt,"components/OrderSortDropdown":vt,"components/PriceInput":it,"components/PriceLabel":ft,"components/ProductSortDropdown":Y,"components/QuantityInput":Ft,"components/QuantityLabel":function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(mt),"components/Sortable":gt,"components/SortableHandle":kt,"helpers/formatPrice":function(t){return t===parseInt(t)&&(t=(t/Math.pow(10,app.forum.attribute("priceDecimals"))).toFixed(app.forum.attribute("priceDecimals"))),[t," "+app.forum.attribute("priceUnit")]},"models/Cart":function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).productCount=Zt.attribute("productCount"),e.priceTotal=Zt.attribute("priceTotal"),e.products=Zt.hasMany("products"),e}i(e,t);var r=e.prototype;return r.priceTotalLocal=function(){return(this.products()||[]).reduce((function(t,e){return t+e.cartPriceTotalLocal()}),0)},r.apiEndpoint=function(){return"/flamarkt/carts"+(this.exists?"/"+this.data.id:"")},e}(Zt),"models/Order":te,"models/OrderLine":ee,"models/Product":re,"pages/AbstractShowPage":G,"states/AbstractListState":_,"states/OrderListState":ct,"states/ProductListState":V,"utils/KeyboardNavigatable":xt},oe={"components/AbstractList":q,"components/AbstractRelationshipSelect":It,"components/BackofficeNav":F,"components/OrderLineEdit":Tt,"components/OrderList":ht,"components/OrderRelationshipSelect":function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).resultsCache=new Map,e}i(e,t);var r=e.prototype;return r.search=function(t){var e=this;return t?app.store.find("flamarkt/orders",{filter:{q:t},page:{limit:5}}).then((function(r){e.resultsCache.set(t,r),m.redraw()})):(m.redraw(),Promise.resolve())},r.results=function(t){if(!t)return[];t=t.toLowerCase();var e=this.resultsCache.get(t);return void 0===e?null:e||[]},r.item=function(t,e){return[e?Pt()(t.number(),e):t.number()]},e}(It),"components/PermanentDeleteButton":ot,"components/ProductList":j,"components/ProductRelationshipSelect":Ct,"components/SoftDeleteButton":nt,"components/SubmitButton":J,"components/UserList":jt,"components/UserRelationshipSelect":Nt,"components/UserSortDropdown":Ht,"pages/DashboardPage":L,"pages/OrderIndexPage":yt,"pages/OrderShowPage":Bt,"pages/ProductIndexPage":$,"pages/ProductShowPage":st,"pages/UserIndexPage":_t,"pages/UserShowPage":Vt,"states/OrderLineEditState":Et,"states/UserListState":Mt},ae=r(8),ie=new Jt;window.app=ie,ie.initializers.add("flamarkt-core",(function(){ie.store.models["flamarkt-orders"]=te,ie.store.models["flamarkt-order-lines"]=ee,ie.store.models["flamarkt-products"]=re,ie.store.models.users.prototype.flamarktOrderCount=o.a.attribute("flamarktOrderCount"),app.extensionData.for("flamarkt-core").registerSetting((function(){var t={};return(app.forum.attribute("flamarktAvailabilityDrivers")||[]).forEach((function(e){t[e]=e})),m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.settings.defaultAvailabilityDriver")),rt.a.component({value:this.setting("flamarkt.defaultAvailabilityDriver")()||"never",options:t,onchange:this.setting("flamarkt.defaultAvailabilityDriver")})])})).registerSetting((function(){var t={};return(app.forum.attribute("flamarktPriceDrivers")||[]).forEach((function(e){t[e]=e})),m(".Form-group",[m("label",app.translator.trans("flamarkt-core.backoffice.settings.defaultPriceDriver")),rt.a.component({value:this.setting("flamarkt.defaultPriceDriver")()||"fixed",options:t,onchange:this.setting("flamarkt.defaultPriceDriver")})])})).registerSetting({type:"switch",setting:"flamarkt.forceOrderPrepayment",label:app.translator.trans("flamarkt-core.backoffice.settings.forceOrderPrepayment")}).registerPermission({icon:"fas fa-shopping-cart",label:app.translator.trans("flamarkt-core.backoffice.permissions.shop"),permission:"flamarkt.shop",allowGuest:!0},"reply").registerPermission({icon:"fas fa-wrench",label:app.translator.trans("flamarkt-core.backoffice.permissions.backoffice"),permission:"backoffice"},"moderate"),Object(ae.override)(Qt.a.prototype,"content",(function(t){return app.forum.attribute("adminUrl")?t():app.extensionData.getSettings(this.extension.id)?m(".ExtensionPage-settings",m(".container",m("h3.ExtensionPage-subHeader",app.translator.trans("flamarkt-core.backoffice.settingsNotAvailableForNonAdmin")))):t()}))})),ie.initializers.add("flamarkt-core-patch",(function(){Object(ae.override)(o.a,"getIdentifier",(function(t,e){return e?t(e):null})),Object(ae.override)(o.a,"hasOne",(function(t,e){return function(){if(this.data.relationships){var r=this.data.relationships[e];if(r&&!r.data)return null}return t(e).call(this)}})),Object(ae.override)(o.a,"getIdentifier",(function(t,e){return e?e.verbatim?(delete e.verbatim,e):t(e):null}))}),100)}]);
//# sourceMappingURL=backoffice.js.map